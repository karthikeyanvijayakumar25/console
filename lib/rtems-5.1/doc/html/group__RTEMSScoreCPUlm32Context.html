<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTEMS: Processor Dependent Context Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rtemslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RTEMS
   &#160;<span id="projectnumber">5.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Processor Dependent Context Management<div class="ingroups"><a class="el" href="group__RTEMSInternal.html">Internal</a> &raquo; <a class="el" href="group__RTEMSScore.html">SuperCore</a> &raquo; <a class="el" href="group__RTEMSScoreCPU.html">CPU Architecture Support</a> &raquo; <a class="el" href="group__RTEMSScoreCPUlm32.html">LatticeMicro32 (lm32)</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structContext__Control.html">Context_Control</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread register context.  <a href="structContext__Control.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCPU__Interrupt__frame.html">CPU_Interrupt_frame</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt stack frame (ISF).  <a href="structCPU__Interrupt__frame.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga896055157b72692a6141f7c0039eabdf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RTEMSScoreCPUlm32Context.html#ga896055157b72692a6141f7c0039eabdf">_CPU_Context_Get_SP</a>(_context)&#160;&#160;&#160;(_context)-&gt;<a class="el" href="group__mips__regs.html#ga8d40798874dab99986478ef00ff3e297">sp</a></td></tr>
<tr class="separator:ga896055157b72692a6141f7c0039eabdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga80726ebfe00f31a88b086cc4474c472f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__RTEMSScoreCPUlm32Context.html#ga80726ebfe00f31a88b086cc4474c472f">_CPU_Context_restore</a> (<a class="el" href="structContext__Control.html">Context_Control</a> *new_context) <a class="el" href="group__RTEMSScoreBaseDefs.html#gaa2f0ed67aa174f684bb31b7e8bdb386f">RTEMS_NO_RETURN</a></td></tr>
<tr class="separator:ga80726ebfe00f31a88b086cc4474c472f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>From the highest level viewpoint, there are 2 types of context to save.</p>
<ol type="1">
<li>Interrupt registers to save</li>
<li>Task level registers to save</li>
</ol>
<p>Since RTEMS handles integer and floating point contexts separately, this means we have the following 3 context items:</p>
<ol type="1">
<li>task level context stuff:: <a class="el" href="structContext__Control.html" title="Thread register context.">Context_Control</a></li>
<li>floating point task stuff:: <a class="el" href="structContext__Control__fp.html" title="SPARC basic context.">Context_Control_fp</a></li>
<li>special interrupt level context :: <a class="el" href="structCPU__Interrupt__frame.html" title="Interrupt stack frame (ISF).">CPU_Interrupt_frame</a></li>
</ol>
<p>On some processors, it is cost-effective to save only the callee preserved registers during a task context switch. This means that the ISR code needs to save those registers which do not persist across function calls. It is not mandatory to make this distinctions between the caller/callee saves registers for the purpose of minimizing context saved during task switch and on interrupts. If the cost of saving extra registers is minimal, simplicity is the choice. Save the same context on interrupt entry as for tasks in this case.</p>
<p>Additionally, if gdb is to be made aware of RTEMS tasks for this CPU, then care should be used in designing the context area.</p>
<p>On some CPUs with hardware floating point support, the <a class="el" href="structContext__Control__fp.html" title="SPARC basic context.">Context_Control_fp</a> structure will not be used or it simply consist of an array of a fixed number of bytes. This is done when the floating point context is dumped by a "FP save context" type instruction and the format is not really defined by the CPU. In this case, there is no need to figure out the exact format &ndash; only the size. Of course, although this is enough information for RTEMS, it is probably not enough for a debugger such as gdb. But that is another problem.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>Should be large enough to run all RTEMS tests. This ensures that a "reasonable" small application should not have any problems.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>Initialize the context to a state suitable for starting a task after a context restore operation. Generally, this involves:</p>
<ul>
<li>setting a starting address</li>
<li>preparing the stack</li>
<li>preparing the stack and frame pointers</li>
<li>setting the proper interrupt level in the context</li>
<li>initializing the floating point context</li>
</ul>
<p>This routine generally does not set any unnecessary register in the context. The state of the "general data" registers is undefined at task start time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">_the_context</td><td>is the context structure to be initialized </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_stack_base</td><td>is the lowest physical address of this task's stack </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_size</td><td>is the size of this task's stack </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_isr</td><td>is the interrupt disable level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_entry_point</td><td>is the thread's entry point. This is always <em>_Thread_Handler</em> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_is_fp</td><td>is TRUE if the thread is to be a floating point thread. This is typically only used on CPUs where the FPU may be easily disabled by software such as on the SPARC where the PSR contains an enable FPU bit.</td></tr>
  </table>
  </dd>
</dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This routine switches from the run context to the heir context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">run</td><td>points to the context of the currently executing task </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">heir</td><td>points to the context of the heir task</td></tr>
  </table>
  </dd>
</dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga896055157b72692a6141f7c0039eabdf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga896055157b72692a6141f7c0039eabdf">&#9670;&nbsp;</a></span>_CPU_Context_Get_SP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _CPU_Context_Get_SP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_context</td><td>)</td>
          <td>&#160;&#160;&#160;(_context)-&gt;<a class="el" href="group__mips__regs.html#ga8d40798874dab99986478ef00ff3e297">sp</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This macro returns the stack pointer associated with <em>_context</em>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">_context</td><td>is the thread context area to access</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This method returns the stack pointer. </dd></dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga80726ebfe00f31a88b086cc4474c472f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga80726ebfe00f31a88b086cc4474c472f">&#9670;&nbsp;</a></span>_CPU_Context_restore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _CPU_Context_restore </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structContext__Control.html">Context_Control</a> *&#160;</td>
          <td class="paramname"><em>new_context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This routine is generally used only to restart self in an efficient manner. It may simply be a label in <a class="el" href="group__RTEMSScoreCPUARM.html#gaa9f8cc989454b28232e5375e30c90970">_CPU_Context_switch</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">new_context</td><td>points to the context to be restored.</td></tr>
  </table>
  </dd>
</dl>
<p>NOTE: May be unnecessary to reload some registers.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This routine is generally used only to restart self in an efficient manner. It may simply be a label in <a class="el" href="group__RTEMSScoreCPUARM.html#gaa9f8cc989454b28232e5375e30c90970">_CPU_Context_switch</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">new_context</td><td>points to the context to be restored.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>May be unnecessary to reload some registers.</dd></dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
