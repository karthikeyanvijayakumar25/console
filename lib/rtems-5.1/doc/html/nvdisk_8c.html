<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTEMS: cpukit/libblock/src/nvdisk.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rtemslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RTEMS
   &#160;<span id="projectnumber">5.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_cd198e36225ba3f41de97552050ac017.html">cpukit</a></li><li class="navelem"><a class="el" href="dir_ba9e32a33b495813694f71ebec04d59b.html">libblock</a></li><li class="navelem"><a class="el" href="dir_a9d9a34363ac19c2d3f60afa775fa7b4.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">nvdisk.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Non-Volatile Disk Block Device Implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="rtems_8h_source.html">rtems.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="libio_8h_source.html">rtems/libio.h</a>&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;<a class="el" href="inttypes_8h_source.html">inttypes.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="blkdev_8h_source.html">rtems/blkdev.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="nvdisk_8h_source.html">rtems/nvdisk.h</a>&gt;</code><br />
<code>#include &lt;rtems/thread.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrtems__nvdisk__device__ctl.html">rtems_nvdisk_device_ctl</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrtems__nvdisk.html">rtems_nvdisk</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a4b3a0935a9be5185c9ca1a47d366865e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvdisk_8c.html#a4b3a0935a9be5185c9ca1a47d366865e">RTEMS_NVDISK_TRACE</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a4b3a0935a9be5185c9ca1a47d366865e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab83edf3d3a2e099da52f80914dd3e2ce"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvdisk_8c.html#ab83edf3d3a2e099da52f80914dd3e2ce">rtems_nvdisk_calc_crc16</a>(_b,  _c)&#160;&#160;&#160;rtems_nvdisk_crc16_factor[((_b) ^ ((_c) &amp; 0xff)) &amp; 0xff] ^ (((_c) &gt;&gt; 8) &amp; 0xff)</td></tr>
<tr class="separator:ab83edf3d3a2e099da52f80914dd3e2ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ab2ae9603d8e6e37c35668bb139065271"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structrtems__nvdisk__device__ctl.html">rtems_nvdisk_device_ctl</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvdisk_8c.html#ab2ae9603d8e6e37c35668bb139065271">rtems_nvdisk_device_ctl</a></td></tr>
<tr class="separator:ab2ae9603d8e6e37c35668bb139065271"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abe720bfb2bdbaffc6fa1f31520259505"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__ClassicStatus.html#ga545d41846817eaba6143d52ee4d9e9fe">rtems_device_driver</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nvdisk_8c.html#abe720bfb2bdbaffc6fa1f31520259505">rtems_nvdisk_initialize</a> (rtems_device_major_number major <a class="el" href="group__RTEMSScoreBaseDefs.html#ga6794c0ff237a90e837e19f9bbcae4297">RTEMS_UNUSED</a>, rtems_device_minor_number minor <a class="el" href="group__RTEMSScoreBaseDefs.html#ga6794c0ff237a90e837e19f9bbcae4297">RTEMS_UNUSED</a>, void *arg <a class="el" href="group__RTEMSScoreBaseDefs.html#ga6794c0ff237a90e837e19f9bbcae4297">RTEMS_UNUSED</a>)</td></tr>
<tr class="separator:abe720bfb2bdbaffc6fa1f31520259505"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Non-Volatile Disk Block Device Implementation. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab83edf3d3a2e099da52f80914dd3e2ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab83edf3d3a2e099da52f80914dd3e2ce">&#9670;&nbsp;</a></span>rtems_nvdisk_calc_crc16</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rtems_nvdisk_calc_crc16</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_b, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_c&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;rtems_nvdisk_crc16_factor[((_b) ^ ((_c) &amp; 0xff)) &amp; 0xff] ^ (((_c) &gt;&gt; 8) &amp; 0xff)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculate the CRC16 checksum.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">_b</td><td>The byte to checksum. </td></tr>
    <tr><td class="paramname">_c</td><td>The current checksum. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4b3a0935a9be5185c9ca1a47d366865e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b3a0935a9be5185c9ca1a47d366865e">&#9670;&nbsp;</a></span>RTEMS_NVDISK_TRACE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RTEMS_NVDISK_TRACE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section note"><dt>Note</dt><dd></dd></dl>
<p>The use of pages can vary. The rtems_nvdisk_*_page set routines use an absolute page number relative to the segment while all other page numbera are relative to the number of page descriptor pages a segment has. You need to add the number of page descriptor pages (pages_desc) to the page number when call the rtems_nvdisk_*_page functions.</p>
<p>You must always show the page number as relative in any trace or error message as device-page and if you have to the page number as absolute use device~page. This can be seen in the page copy routine.</p>
<p>The code is like this to avoid needing the pass the pages_desc value around. It is only used in selected places and so the extra parameter was avoided.Control tracing. It can be compiled out of the code for small footprint targets. Leave in by default. </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ab2ae9603d8e6e37c35668bb139065271"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2ae9603d8e6e37c35668bb139065271">&#9670;&nbsp;</a></span>rtems_nvdisk_device_ctl</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structrtems__nvdisk__device__ctl.html">rtems_nvdisk_device_ctl</a>  <a class="el" href="structrtems__nvdisk__device__ctl.html">rtems_nvdisk_device_ctl</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>NV Device Control holds the segment controls </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="abe720bfb2bdbaffc6fa1f31520259505"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe720bfb2bdbaffc6fa1f31520259505">&#9670;&nbsp;</a></span>rtems_nvdisk_initialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__ClassicStatus.html#ga545d41846817eaba6143d52ee4d9e9fe">rtems_device_driver</a> rtems_nvdisk_initialize </td>
          <td>(</td>
          <td class="paramtype">rtems_device_major_number major&#160;</td>
          <td class="paramname"><em>RTEMS_UNUSED</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">rtems_device_minor_number minor&#160;</td>
          <td class="paramname"><em>RTEMS_UNUSED</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *arg&#160;</td>
          <td class="paramname"><em>RTEMS_UNUSED</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>NV disk device driver initialization.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000013">Todo:</a></b></dt><dd>Memory clean up on error is really badly handled.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">major</td><td>NV disk major device number. </td></tr>
    <tr><td class="paramname">minor</td><td>Minor device number, not applicable. </td></tr>
    <tr><td class="paramname">arg</td><td>Initialization argument, not applicable. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
