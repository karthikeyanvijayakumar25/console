<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTEMS: Processor Dependent Context Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rtemslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RTEMS
   &#160;<span id="projectnumber">5.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Processor Dependent Context Management<div class="ingroups"><a class="el" href="group__RTEMSInternal.html">Internal</a> &raquo; <a class="el" href="group__RTEMSScore.html">SuperCore</a> &raquo; <a class="el" href="group__RTEMSScoreCPU.html">CPU Architecture Support</a> &raquo; <a class="el" href="group__RTEMSScoreCPUExample.html">Example</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Destroys the context of the thread.  
<a href="#details">More...</a></p>
<p>Destroys the context of the thread. </p>
<p>Initializes and validates the CPU context with values derived from the pattern parameter.</p>
<p>Clobbers all volatile registers with values derived from the pattern parameter.</p>
<p>From the highest level viewpoint, there are 2 types of context to save.</p>
<ol type="1">
<li>Interrupt registers to save</li>
<li>Task level registers to save</li>
</ol>
<p>Since RTEMS handles integer and floating point contexts separately, this means we have the following 3 context items:</p>
<ol type="1">
<li>task level context stuff:: <a class="el" href="structContext__Control.html" title="Thread register context.">Context_Control</a></li>
<li>floating point task stuff:: <a class="el" href="structContext__Control__fp.html" title="SPARC basic context.">Context_Control_fp</a></li>
<li>special interrupt level context :: <a class="el" href="structCPU__Interrupt__frame.html" title="Interrupt stack frame (ISF).">CPU_Interrupt_frame</a></li>
</ol>
<p>On some processors, it is cost-effective to save only the callee preserved registers during a task context switch. This means that the ISR code needs to save those registers which do not persist across function calls. It is not mandatory to make this distinctions between the caller/callee saves registers for the purpose of minimizing context saved during task switch and on interrupts. If the cost of saving extra registers is minimal, simplicity is the choice. Save the same context on interrupt entry as for tasks in this case.</p>
<p>Additionally, if gdb is to be made aware of RTEMS tasks for this CPU, then care should be used in designing the context area.</p>
<p>On some CPUs with hardware floating point support, the <a class="el" href="structContext__Control__fp.html" title="SPARC basic context.">Context_Control_fp</a> structure will not be used or it simply consist of an array of a fixed number of bytes. This is done when the floating point context is dumped by a "FP save context" type instruction and the format is not really defined by the CPU. In this case, there is no need to figure out the exact format &ndash; only the size. Of course, although this is enough information for RTEMS, it is probably not enough for a debugger such as gdb. But that is another problem.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>The size of the floating point context area. On some CPUs this will not be a "sizeof" because the format of the floating point area is not defined &ndash; only the size is. This is usually on CPUs with a "floating point save context" instruction.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>Should be large enough to run all RTEMS tests. This ensures that a "reasonable" small application should not have any problems.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>It must be implemented as a macro and an implementation is optional. The default implementation does nothing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">_the_thread</td><td>The corresponding thread. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_the_context</td><td>The context to destroy.</td></tr>
  </table>
  </dd>
</dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>Initialize the context to a state suitable for starting a task after a context restore operation. Generally, this involves:</p>
<ul>
<li>setting a starting address</li>
<li>preparing the stack</li>
<li>preparing the stack and frame pointers</li>
<li>setting the proper interrupt level in the context</li>
<li>initializing the floating point context</li>
</ul>
<p>This routine generally does not set any unnecessary register in the context. The state of the "general data" registers is undefined at task start time.</p>
<p>The ISR dispatch disable field of the context must be cleared to zero if it is used by the CPU port. Otherwise, a thread restart results in unpredictable behaviour.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">_the_context</td><td>is the context structure to be initialized </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_stack_base</td><td>is the lowest physical address of this task's stack </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_size</td><td>is the size of this task's stack </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_isr</td><td>is the interrupt disable level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_entry_point</td><td>is the thread's entry point. This is always <em>_Thread_Handler</em> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_is_fp</td><td>is TRUE if the thread is to be a floating point thread. This is typically only used on CPUs where the FPU may be easily disabled by software such as on the SPARC where the PSR contains an enable FPU bit. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">_tls_area</td><td>The thread-local storage (TLS) area.</td></tr>
  </table>
  </dd>
</dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This routine switches from the run context to the heir context.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">run</td><td>points to the context of the currently executing task </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">heir</td><td>points to the context of the heir task</td></tr>
  </table>
  </dd>
</dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This routine is generally used only to restart self in an efficient manner. It may simply be a label in <a class="el" href="group__RTEMSScoreCPUARM.html#gaa9f8cc989454b28232e5375e30c90970">_CPU_Context_switch</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">new_context</td><td>points to the context to be restored.</td></tr>
  </table>
  </dd>
</dl>
<p>NOTE: May be unnecessary to reload some registers.</p>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This routine saves the floating point context passed to it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_context_ptr</td><td>is a pointer to a pointer to a floating point context area</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>on output <em>*fp_context_ptr</em> will contain the address that should be used with <a class="el" href="sparc_2include_2rtems_2score_2cpu_8h.html#a8d77a957f827a9250794f9ad754acbf5">_CPU_Context_restore_fp</a> to restore this context.</dd></dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This routine restores the floating point context passed to it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fp_context_ptr</td><td>is a pointer to a pointer to a floating point context area to restore</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>on output <em>*fp_context_ptr</em> will contain the address that should be used with <a class="el" href="sparc_2include_2rtems_2score_2cpu_8h.html#ae8d9251a320d6920e3c8d6e45eb38fad">_CPU_Context_save_fp</a> to save this context.</dd></dl>
<p>Port Specific Information:</p>
<p>XXX document implementation including references if appropriate</p>
<p>This function is used only in test sptests/spcontext01.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pattern</td><td>Pattern used to generate distinct register values.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>_CPU_Context_validate().</dd></dl>
<p>This function will not return if the CPU context remains consistent. In case this function returns the CPU port is broken.</p>
<p>This function is used only in test sptests/spcontext01.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pattern</td><td>Pattern used to generate distinct register values.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>_CPU_Context_volatile_clobber(). </dd></dl>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
