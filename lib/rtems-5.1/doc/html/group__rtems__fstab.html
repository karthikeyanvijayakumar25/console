<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RTEMS: File System Mount Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rtemslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RTEMS
   &#160;<span id="projectnumber">5.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">File System Mount Support<div class="ingroups"><a class="el" href="group__LibIO.html">IO Library</a> &raquo; <a class="el" href="group__FileSystemTypesAndMount.html">File System Types and Mount</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>File System Mount Functions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:fsmount_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsmount_8c.html">fsmount.c</a></td></tr>
<tr class="memdesc:fsmount_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">File System Mount Functions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrtems__fstab__entry.html">rtems_fstab_entry</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gabcbeff39e673bbef9ec0960f64d19228"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rtems__fstab.html#gabcbeff39e673bbef9ec0960f64d19228">rtems_fstab_conditions</a> { <br />
&#160;&#160;<a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a02b814a4e2912b3798f9461f21c653d0">RTEMS_FSTAB_NONE</a> = 0U, 
<a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a599040e2f9b9138f579b4afe2d89e74f">RTEMS_FSTAB_OK</a> = 0x1U, 
<a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a45c5b0422063b6c6f7639592599a4a14">RTEMS_FSTAB_ERROR_MOUNT_POINT</a> = 0x2U, 
<a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228abea4e604d901dfde4675a0a371e4ff32">RTEMS_FSTAB_ERROR_MOUNT</a> = 0x4U, 
<br />
&#160;&#160;<a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a4f7b97e87454e1faea9e4157d8da1c35">RTEMS_FSTAB_ERROR</a> = RTEMS_FSTAB_ERROR_MOUNT_POINT | RTEMS_FSTAB_ERROR_MOUNT, 
<a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a7d5868d458848d9f2a99fe67d4016360">RTEMS_FSTAB_ANY</a> = RTEMS_FSTAB_OK | RTEMS_FSTAB_ERROR
<br />
 }</td></tr>
<tr class="separator:gabcbeff39e673bbef9ec0960f64d19228"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaa1e00bfe1aa6bce349c2c73092a39cc6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rtems__fstab.html#gaa1e00bfe1aa6bce349c2c73092a39cc6">rtems_fsmount</a> (const <a class="el" href="structrtems__fstab__entry.html">rtems_fstab_entry</a> *fstab, size_t <a class="el" href="sun4u_2tte_8h.html#a245260f6f74972558f61b85227df5aae">size</a>, size_t *abort_index)</td></tr>
<tr class="memdesc:gaa1e00bfe1aa6bce349c2c73092a39cc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mounts the file systems listed in the file system mount table.  <a href="#gaa1e00bfe1aa6bce349c2c73092a39cc6">More...</a><br /></td></tr>
<tr class="separator:gaa1e00bfe1aa6bce349c2c73092a39cc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>File System Mount Functions. </p>
<p>This file contains the fsmount functions. These functions</p>
<p>are used to mount a list of filesystems (and create their mount points before). </p>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="gabcbeff39e673bbef9ec0960f64d19228"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabcbeff39e673bbef9ec0960f64d19228">&#9670;&nbsp;</a></span>rtems_fstab_conditions</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__rtems__fstab.html#gabcbeff39e673bbef9ec0960f64d19228">rtems_fstab_conditions</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>File system mount report and abort condition flags.</p>
<p>The flags define, which conditions will cause a report during the mount process (via printf()) or abort the mount process.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="structrtems__fstab__entry.html">rtems_fstab_entry</a> and <a class="el" href="group__rtems__fstab.html#gaa1e00bfe1aa6bce349c2c73092a39cc6" title="Mounts the file systems listed in the file system mount table.">rtems_fsmount()</a>. </dd></dl>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ggabcbeff39e673bbef9ec0960f64d19228a02b814a4e2912b3798f9461f21c653d0"></a>RTEMS_FSTAB_NONE&#160;</td><td class="fielddoc"><p>No conditions. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabcbeff39e673bbef9ec0960f64d19228a599040e2f9b9138f579b4afe2d89e74f"></a>RTEMS_FSTAB_OK&#160;</td><td class="fielddoc"><p>Complete mount process was successful. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabcbeff39e673bbef9ec0960f64d19228a45c5b0422063b6c6f7639592599a4a14"></a>RTEMS_FSTAB_ERROR_MOUNT_POINT&#160;</td><td class="fielddoc"><p>Mount point creation failed. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabcbeff39e673bbef9ec0960f64d19228abea4e604d901dfde4675a0a371e4ff32"></a>RTEMS_FSTAB_ERROR_MOUNT&#160;</td><td class="fielddoc"><p>File system mount failed. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabcbeff39e673bbef9ec0960f64d19228a4f7b97e87454e1faea9e4157d8da1c35"></a>RTEMS_FSTAB_ERROR&#160;</td><td class="fielddoc"><p>Something failed. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggabcbeff39e673bbef9ec0960f64d19228a7d5868d458848d9f2a99fe67d4016360"></a>RTEMS_FSTAB_ANY&#160;</td><td class="fielddoc"><p>Any condition. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaa1e00bfe1aa6bce349c2c73092a39cc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa1e00bfe1aa6bce349c2c73092a39cc6">&#9670;&nbsp;</a></span>rtems_fsmount()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rtems_fsmount </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structrtems__fstab__entry.html">rtems_fstab_entry</a> *&#160;</td>
          <td class="paramname"><em>fstab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>abort_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mounts the file systems listed in the file system mount table. </p>
<p>Mounts the file systems listed in the file system mount table <em>fstab</em> of size <em>size</em>.</p>
<p>Each file system will be mounted according to its table entry parameters. In case of an abort condition the corresponding table index will be reported in <em>abort_index</em>. The pointer <em>abort_index</em> may be <code>NULL</code>. The mount point paths will be created with <a class="el" href="group__LibIO.html#gad15bb6c81ba9ed35ec75103d13bde734" title="Creates a directory and all its parent directories according to path.">rtems_mkdir()</a> and need not exist beforehand.</p>
<p>On success, zero is returned. On error, -1 is returned, and <code>errno</code> is set appropriately.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__rtems__bdpart.html#ga9b0517982a75560e134c808e70885b81">rtems_bdpart_register_from_disk()</a>.</dd></dl>
<p>The following example code tries to mount a FAT file system within a SD Card. Some cards do not have a partition table so at first it tries to find a file system inside the hole disk. If this is successful the mount process will be aborted because the <a class="el" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a599040e2f9b9138f579b4afe2d89e74f">RTEMS_FSTAB_OK</a> condition is true. If this did not work it tries to mount the file system inside the first partition. If this fails the mount process will not be aborted (this is already the last entry), but the last error status will be returned.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rtems_8h.html">rtems.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bdpart_8h.html">rtems/bdpart.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="error_8h.html">rtems/error.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fsmount_8h.html">rtems/fsmount.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structrtems__fstab__entry.html">rtems_fstab_entry</a> fstab [] = {</div><div class="line">  {</div><div class="line">    .<a class="code" href="structrtems__fstab__entry.html#a399f942386cf428636ba749fc076dc8d">source</a> = <span class="stringliteral">&quot;/dev/sd-card-a&quot;</span>,</div><div class="line">    .target = <span class="stringliteral">&quot;/mnt&quot;</span>,</div><div class="line">    .type = <span class="stringliteral">&quot;dosfs&quot;</span>,</div><div class="line">    .options = RTEMS_FILESYSTEM_READ_WRITE,</div><div class="line">    .report_reasons = <a class="code" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a7d5868d458848d9f2a99fe67d4016360">RTEMS_FSTAB_ANY</a>,</div><div class="line">    .abort_reasons = <a class="code" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a599040e2f9b9138f579b4afe2d89e74f">RTEMS_FSTAB_OK</a></div><div class="line">  }, {</div><div class="line">    .source = <span class="stringliteral">&quot;/dev/sd-card-a1&quot;</span>,</div><div class="line">    .target = <span class="stringliteral">&quot;/mnt&quot;</span>,</div><div class="line">    .type = <span class="stringliteral">&quot;dosfs&quot;</span>,</div><div class="line">    .options = RTEMS_FILESYSTEM_READ_WRITE,</div><div class="line">    .report_reasons = <a class="code" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a7d5868d458848d9f2a99fe67d4016360">RTEMS_FSTAB_ANY</a>,</div><div class="line">    .abort_reasons = <a class="code" href="group__rtems__fstab.html#ggabcbeff39e673bbef9ec0960f64d19228a02b814a4e2912b3798f9461f21c653d0">RTEMS_FSTAB_NONE</a></div><div class="line">  }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> my_mount(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  <a class="code" href="group__ClassicStatus.html#ga545d41846817eaba6143d52ee4d9e9fe">rtems_status_code</a> sc = <a class="code" href="group__ClassicStatus.html#gga545d41846817eaba6143d52ee4d9e9fea8a23e2d94778f09399da984d73562536">RTEMS_SUCCESSFUL</a>;</div><div class="line">  <span class="keywordtype">int</span> rv = 0;</div><div class="line">  <span class="keywordtype">size_t</span> abort_index = 0;</div><div class="line"></div><div class="line">  sc = <a class="code" href="group__rtems__bdpart.html#ga9b0517982a75560e134c808e70885b81">rtems_bdpart_register_from_disk</a>(<span class="stringliteral">&quot;/dev/sd-card-a&quot;</span>);</div><div class="line">  <span class="keywordflow">if</span> (sc != <a class="code" href="group__ClassicStatus.html#gga545d41846817eaba6143d52ee4d9e9fea8a23e2d94778f09399da984d73562536">RTEMS_SUCCESSFUL</a>) {</div><div class="line">    printf(<span class="stringliteral">&quot;read partition table failed: %s\n&quot;</span>, <a class="code" href="group__ClassicStatus.html#ga2266bf8df3365634df546ace2d0f1146">rtems_status_text</a>(sc));</div><div class="line">  }</div><div class="line"></div><div class="line">  rv = <a class="code" href="group__rtems__fstab.html#gaa1e00bfe1aa6bce349c2c73092a39cc6">rtems_fsmount</a>(fstab, <span class="keyword">sizeof</span>(fstab) / <span class="keyword">sizeof</span>(fstab [0]), &amp;abort_index);</div><div class="line">  <span class="keywordflow">if</span> (rv != 0) {</div><div class="line">    printf(<span class="stringliteral">&quot;mount failed: %s\n&quot;</span>, strerror(errno));</div><div class="line">  }</div><div class="line">  printf(<span class="stringliteral">&quot;mount aborted at %zu\n&quot;</span>, abort_index);</div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
