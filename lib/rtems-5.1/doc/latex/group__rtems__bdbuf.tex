\hypertarget{group__rtems__bdbuf}{}\section{Block Device Buffer Management}
\label{group__rtems__bdbuf}\index{Block Device Buffer Management@{Block Device Buffer Management}}
\subsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{bdbuf_8h}{bdbuf.\+h}}
\begin{DoxyCompactList}\small\item\em Block Device Buffer Management. \end{DoxyCompactList}\item 
file \mbox{\hyperlink{bdbuf_8c}{bdbuf.\+c}}
\end{DoxyCompactItemize}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}}
\item 
struct \mbox{\hyperlink{structrtems__bdbuf__group}{rtems\+\_\+bdbuf\+\_\+group}}
\item 
struct \mbox{\hyperlink{structrtems__bdbuf__config}{rtems\+\_\+bdbuf\+\_\+config}}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_gaae5144ea7d6721e55dfeda0c8df8d370}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+M\+A\+X\+\_\+\+R\+E\+A\+D\+\_\+\+A\+H\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+\_\+\+D\+E\+F\+A\+U\+LT}}~0
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga9572529188b3c315f4f0b0b160129dba}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+M\+A\+X\+\_\+\+W\+R\+I\+T\+E\+\_\+\+B\+L\+O\+C\+K\+S\+\_\+\+D\+E\+F\+A\+U\+LT}}~16
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}~15
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga2286d9fcac2fdd6f19497da7faa82f81}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+S\+W\+A\+P\+\_\+\+P\+E\+R\+I\+O\+D\+\_\+\+D\+E\+F\+A\+U\+LT}}~250
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_gab5083de2064c8c45031afe425b65812d}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+B\+L\+O\+C\+K\+\_\+\+H\+O\+L\+D\+\_\+\+D\+E\+F\+A\+U\+LT}}~1000
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga43a9167effd55601db78237e927c0288}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+W\+O\+R\+K\+E\+R\+\_\+\+T\+A\+S\+K\+S\+\_\+\+D\+E\+F\+A\+U\+LT}}~0
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga49a9f2ff52d57ceb4f3897da82942fee}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+W\+O\+R\+K\+E\+R\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}~\mbox{\hyperlink{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga6e516e2a5ff9d285cef0aacb6c0768c1}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+R\+E\+A\+D\+\_\+\+A\+H\+E\+A\+D\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}~\mbox{\hyperlink{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga39a54490a2930a1a321c5b06cc5e3e54}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+T\+A\+S\+K\+\_\+\+S\+T\+A\+C\+K\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT}}~\mbox{\hyperlink{group__RTEMSAPIClassic_ga2e35188053c5e97a85df8e3aa4d23d2f}{R\+T\+E\+M\+S\+\_\+\+M\+I\+N\+I\+M\+U\+M\+\_\+\+S\+T\+A\+C\+K\+\_\+\+S\+I\+ZE}}
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga2bb4bb2bf0d5333d78272725eab143f8}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+C\+A\+C\+H\+E\+\_\+\+M\+E\+M\+O\+R\+Y\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT}}~(64 $\ast$ 512)
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_gaad496ebd5fc85425bc1d8545955051ca}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT}}~(512)
\item 
\#define \mbox{\hyperlink{group__rtems__bdbuf_ga3de9417ce0cc9bce90e924796c191cc2}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+M\+A\+X\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT}}~(4096)
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group__rtems__bdbuf_gac1425c77af823674c78f853694284a44}\label{group__rtems__bdbuf_gac1425c77af823674c78f853694284a44}} 
typedef struct \mbox{\hyperlink{structrtems__bdbuf__group}{rtems\+\_\+bdbuf\+\_\+group}} {\bfseries rtems\+\_\+bdbuf\+\_\+group}
\item 
typedef struct \mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} \mbox{\hyperlink{group__rtems__bdbuf_gacce5a2661bea8023c1b5097f7566f051}{rtems\+\_\+bdbuf\+\_\+buffer}}
\item 
typedef struct \mbox{\hyperlink{structrtems__bdbuf__config}{rtems\+\_\+bdbuf\+\_\+config}} \mbox{\hyperlink{group__rtems__bdbuf_gaf4f5fc331dd33379471c78d5459c69f7}{rtems\+\_\+bdbuf\+\_\+config}}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{group__rtems__bdbuf_ga0169f36547d36f0723b6456172eeef0a}{rtems\+\_\+bdbuf\+\_\+buf\+\_\+state}} \{ \newline
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa71f15d80aec284191be9dd7aa16ba12c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+F\+R\+EE}} = 0, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aaf20ea6300aa6f0c306411e459e346655}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+E\+M\+P\+TY}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aac3b227c132567db236f300a26b092a69}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+A\+C\+H\+ED}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa366b8d851fe5a11f4733c00b1409df7d}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+C\+A\+C\+H\+ED}}, 
\newline
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aab079a61b153c4b0313bcc2a788131e02}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+M\+O\+D\+I\+F\+I\+ED}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa4939e1384db29ded8d98dff95580a4ed}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+E\+M\+P\+TY}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa4ae71d01cced39a3dc2339a68d5fdb3c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+P\+U\+R\+G\+ED}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aad4ad56ebb96642f2c35a59d50e04cdc8}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+M\+O\+D\+I\+F\+I\+ED}}, 
\newline
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa2c826ea2246ca7a4bab97a5879cbf99d}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+S\+Y\+NC}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa50fc56fabf62a4753588ad64aabb2c9c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+R\+A\+N\+S\+F\+ER}}, 
\mbox{\hyperlink{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aacef35ec154e4f4fe26262af3ed685ca7}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+R\+A\+N\+S\+F\+E\+R\+\_\+\+P\+U\+R\+G\+ED}}
 \}
\begin{DoxyCompactList}\small\item\em State of a buffer of the cache. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init}} (void)
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga05fa34cc25ade6d09797b0dc88cf33e1}{rtems\+\_\+bdbuf\+\_\+get}} (\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd, \mbox{\hyperlink{group__rtems__disk_ga5fbcfd40b657bff6c54d9e393fab3274}{rtems\+\_\+blkdev\+\_\+bnum}} block, \mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$$\ast$bd)
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga8546cefc842eef10cdb5b38a6cead9f7}{rtems\+\_\+bdbuf\+\_\+read}} (\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd, \mbox{\hyperlink{group__rtems__disk_ga5fbcfd40b657bff6c54d9e393fab3274}{rtems\+\_\+blkdev\+\_\+bnum}} block, \mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$$\ast$bd)
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga005a3a396079975d67eac6de5640d744}{rtems\+\_\+bdbuf\+\_\+release}} (\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$bd)
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga3f8af85cf0abcb0858811f74130aa6c7}{rtems\+\_\+bdbuf\+\_\+release\+\_\+modified}} (\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$bd)
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga9a49c1519760b60eace0463277af50ee}{rtems\+\_\+bdbuf\+\_\+sync}} (\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$bd)
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga1f02deb0d0ca33a6b9da04b9f3f2078d}{rtems\+\_\+bdbuf\+\_\+syncdev}} (\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd)
\item 
void \mbox{\hyperlink{group__rtems__bdbuf_gadc7712bcd488ea249f4a84d362126d46}{rtems\+\_\+bdbuf\+\_\+purge\+\_\+dev}} (\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd)
\begin{DoxyCompactList}\small\item\em Purges all buffers corresponding to the disk device {\itshape dd}. \end{DoxyCompactList}\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__rtems__bdbuf_ga649b3b4fb368921f579a0204552a7a60}{rtems\+\_\+bdbuf\+\_\+set\+\_\+block\+\_\+size}} (\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd, uint32\+\_\+t block\+\_\+size, bool \mbox{\hyperlink{sync_8c_ac4fa2e6d36e97983d62b9377cc4f6c73}{sync}})
\begin{DoxyCompactList}\small\item\em Sets the block size of a disk device. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__rtems__bdbuf_ga9dd6ce1ba113683d019a29d04861f33d}\label{group__rtems__bdbuf_ga9dd6ce1ba113683d019a29d04861f33d}} 
void \mbox{\hyperlink{group__rtems__bdbuf_ga9dd6ce1ba113683d019a29d04861f33d}{rtems\+\_\+bdbuf\+\_\+get\+\_\+device\+\_\+stats}} (const \mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd, \mbox{\hyperlink{structrtems__blkdev__stats}{rtems\+\_\+blkdev\+\_\+stats}} $\ast$stats)
\begin{DoxyCompactList}\small\item\em Returns the block device statistics. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{group__rtems__bdbuf_ga2f88a5110e6063af34b36063edd291f1}\label{group__rtems__bdbuf_ga2f88a5110e6063af34b36063edd291f1}} 
void \mbox{\hyperlink{group__rtems__bdbuf_ga2f88a5110e6063af34b36063edd291f1}{rtems\+\_\+bdbuf\+\_\+reset\+\_\+device\+\_\+stats}} (\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$dd)
\begin{DoxyCompactList}\small\item\em Resets the block device statistics. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \mbox{\hyperlink{structrtems__bdbuf__config}{rtems\+\_\+bdbuf\+\_\+config}} \mbox{\hyperlink{group__rtems__bdbuf_gac1ab295c43675e17b20a7af3956c2a72}{rtems\+\_\+bdbuf\+\_\+configuration}}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
The Block Device Buffer Management implements a cache between the disk devices and file systems. The code provides read-\/ahead and write queuing to the drivers and fast cache look-\/up using an A\+VL tree.

The block size used by a file system can be set at runtime and must be a multiple of the disk device block size. The disk device\textquotesingle{}s physical block size is called the media block size. The file system can set the block size it uses to a larger multiple of the media block size. The driver must be able to handle buffers sizes larger than one media block.

The user configures the amount of memory to be used as buffers in the cache, and the minimum and maximum buffer size. The cache will allocate additional memory for the buffer descriptors and groups. There are enough buffer descriptors allocated so all the buffer memory can be used as minimum sized buffers.

The cache is a single pool of buffers. The buffer memory is divided into groups where the size of buffer memory allocated to a group is the maximum buffer size. A group\textquotesingle{}s memory can be divided down into small buffer sizes that are a multiple of 2 of the minimum buffer size. A group is the minimum allocation unit for buffers of a specific size. If a buffer of maximum size is request the group will have a single buffer. If a buffer of minimum size is requested the group is divided into minimum sized buffers and the remaining buffers are held ready for use. A group keeps track of which buffers are with a file system or driver and groups who have buffer in use cannot be realloced. Groups with no buffers in use can be taken and realloced to a new size. This is how buffers of different sizes move around the cache.

The buffers are held in various lists in the cache. All buffers follow this state machine\+:


\begin{DoxyImageNoCaption}
  \mbox{\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{dot_inline_dotgraph_1}}
\end{DoxyImageNoCaption}


Empty or cached buffers are added to the L\+RU list and removed from this queue when a caller requests a buffer. This is referred to as getting a buffer in the code and the event get in the state diagram. The buffer is assigned to a block and inserted to the A\+VL based on the block/device key. If the block is to be read by the user and not in the cache it is transfered from the disk into memory. If no buffers are on the L\+RU list the modified list is checked. If buffers are on the modified the swap out task will be woken. The request blocks until a buffer is available for recycle.

A block being accessed is given to the file system layer and not accessible to another requester until released back to the cache. The same goes to a buffer in the transfer state. The transfer state means being read or written. If the file system has modified the block and releases it as modified it placed on the cache\textquotesingle{}s modified list and a hold timer initialised. The buffer is held for the hold time before being written to disk. Buffers are held for a configurable period of time on the modified list as a write sets the state to transfer and this locks the buffer out from the file system until the write completes. Buffers are often accessed and modified in a series of small updates so if sent to the disk when released as modified the user would have to block waiting until it had been written. This would be a performance problem.

The code performs multiple block reads and writes. Multiple block reads or read-\/ahead increases performance with hardware that supports it. It also helps with a large cache as the disk head movement is reduced. It however is a speculative operation so excessive use can remove valuable and needed blocks from the cache. The read-\/ahead is triggered after two misses of ascending consecutive blocks or a read hit of a block read by the most-\/resent read-\/ahead transfer. The read-\/ahead works per disk, but all transfers are issued by the read-\/ahead task.

The cache has the following lists of buffers\+:
\begin{DoxyItemize}
\item L\+RU\+: Accessed or transfered buffers released in least recently used order. Empty buffers will be placed to the front.
\item Modified\+: Buffers waiting to be written to disk.
\item Sync\+: Buffers to be synchronized with the disk.
\end{DoxyItemize}

A cache look-\/up will be performed to find a suitable buffer. A suitable buffer is one that matches the same allocation size as the device the buffer is for. The a buffer\textquotesingle{}s group has no buffers in use with the file system or driver the group is reallocated. This means the buffers in the group are invalidated, resized and placed on the L\+RU queue. There is a performance issue with this design. The reallocation of a group may forced recently accessed buffers out of the cache when they should not. The design should be change to have groups on a L\+RU list if they have no buffers in use. 

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{group__rtems__bdbuf_ga3de9417ce0cc9bce90e924796c191cc2}\label{group__rtems__bdbuf_ga3de9417ce0cc9bce90e924796c191cc2}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_BUFFER\_MAX\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_BUFFER\_MAX\_SIZE\_DEFAULT}}
\index{RTEMS\_BDBUF\_BUFFER\_MAX\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_BUFFER\_MAX\_SIZE\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_BUFFER\_MAX\_SIZE\_DEFAULT}{RTEMS\_BDBUF\_BUFFER\_MAX\_SIZE\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+M\+A\+X\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT~(4096)}

Default maximum size of buffers. \mbox{\Hypertarget{group__rtems__bdbuf_gaad496ebd5fc85425bc1d8545955051ca}\label{group__rtems__bdbuf_gaad496ebd5fc85425bc1d8545955051ca}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_BUFFER\_MIN\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_BUFFER\_MIN\_SIZE\_DEFAULT}}
\index{RTEMS\_BDBUF\_BUFFER\_MIN\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_BUFFER\_MIN\_SIZE\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_BUFFER\_MIN\_SIZE\_DEFAULT}{RTEMS\_BDBUF\_BUFFER\_MIN\_SIZE\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT~(512)}

Default minimum size of buffers. \mbox{\Hypertarget{group__rtems__bdbuf_ga2bb4bb2bf0d5333d78272725eab143f8}\label{group__rtems__bdbuf_ga2bb4bb2bf0d5333d78272725eab143f8}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_CACHE\_MEMORY\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_CACHE\_MEMORY\_SIZE\_DEFAULT}}
\index{RTEMS\_BDBUF\_CACHE\_MEMORY\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_CACHE\_MEMORY\_SIZE\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_CACHE\_MEMORY\_SIZE\_DEFAULT}{RTEMS\_BDBUF\_CACHE\_MEMORY\_SIZE\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+C\+A\+C\+H\+E\+\_\+\+M\+E\+M\+O\+R\+Y\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT~(64 $\ast$ 512)}

Default size of memory allocated to the cache. \mbox{\Hypertarget{group__rtems__bdbuf_gaae5144ea7d6721e55dfeda0c8df8d370}\label{group__rtems__bdbuf_gaae5144ea7d6721e55dfeda0c8df8d370}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_MAX\_READ\_AHEAD\_BLOCKS\_DEFAULT@{RTEMS\_BDBUF\_MAX\_READ\_AHEAD\_BLOCKS\_DEFAULT}}
\index{RTEMS\_BDBUF\_MAX\_READ\_AHEAD\_BLOCKS\_DEFAULT@{RTEMS\_BDBUF\_MAX\_READ\_AHEAD\_BLOCKS\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_MAX\_READ\_AHEAD\_BLOCKS\_DEFAULT}{RTEMS\_BDBUF\_MAX\_READ\_AHEAD\_BLOCKS\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+M\+A\+X\+\_\+\+R\+E\+A\+D\+\_\+\+A\+H\+E\+A\+D\+\_\+\+B\+L\+O\+C\+K\+S\+\_\+\+D\+E\+F\+A\+U\+LT~0}

The default value for the maximum read-\/ahead blocks disables the read-\/ahead feature. \mbox{\Hypertarget{group__rtems__bdbuf_ga9572529188b3c315f4f0b0b160129dba}\label{group__rtems__bdbuf_ga9572529188b3c315f4f0b0b160129dba}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_MAX\_WRITE\_BLOCKS\_DEFAULT@{RTEMS\_BDBUF\_MAX\_WRITE\_BLOCKS\_DEFAULT}}
\index{RTEMS\_BDBUF\_MAX\_WRITE\_BLOCKS\_DEFAULT@{RTEMS\_BDBUF\_MAX\_WRITE\_BLOCKS\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_MAX\_WRITE\_BLOCKS\_DEFAULT}{RTEMS\_BDBUF\_MAX\_WRITE\_BLOCKS\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+M\+A\+X\+\_\+\+W\+R\+I\+T\+E\+\_\+\+B\+L\+O\+C\+K\+S\+\_\+\+D\+E\+F\+A\+U\+LT~16}

Default maximum number of blocks to write at once. \mbox{\Hypertarget{group__rtems__bdbuf_ga6e516e2a5ff9d285cef0aacb6c0768c1}\label{group__rtems__bdbuf_ga6e516e2a5ff9d285cef0aacb6c0768c1}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_READ\_AHEAD\_TASK\_PRIORITY\_DEFAULT@{RTEMS\_BDBUF\_READ\_AHEAD\_TASK\_PRIORITY\_DEFAULT}}
\index{RTEMS\_BDBUF\_READ\_AHEAD\_TASK\_PRIORITY\_DEFAULT@{RTEMS\_BDBUF\_READ\_AHEAD\_TASK\_PRIORITY\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_READ\_AHEAD\_TASK\_PRIORITY\_DEFAULT}{RTEMS\_BDBUF\_READ\_AHEAD\_TASK\_PRIORITY\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+R\+E\+A\+D\+\_\+\+A\+H\+E\+A\+D\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT~\mbox{\hyperlink{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}}

Default read-\/ahead task priority. The same as the swap-\/out task. \mbox{\Hypertarget{group__rtems__bdbuf_gab5083de2064c8c45031afe425b65812d}\label{group__rtems__bdbuf_gab5083de2064c8c45031afe425b65812d}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_SWAPOUT\_TASK\_BLOCK\_HOLD\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_TASK\_BLOCK\_HOLD\_DEFAULT}}
\index{RTEMS\_BDBUF\_SWAPOUT\_TASK\_BLOCK\_HOLD\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_TASK\_BLOCK\_HOLD\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_SWAPOUT\_TASK\_BLOCK\_HOLD\_DEFAULT}{RTEMS\_BDBUF\_SWAPOUT\_TASK\_BLOCK\_HOLD\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+B\+L\+O\+C\+K\+\_\+\+H\+O\+L\+D\+\_\+\+D\+E\+F\+A\+U\+LT~1000}

Default swap-\/out task block hold time in milli seconds. \mbox{\Hypertarget{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}\label{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_SWAPOUT\_TASK\_PRIORITY\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_TASK\_PRIORITY\_DEFAULT}}
\index{RTEMS\_BDBUF\_SWAPOUT\_TASK\_PRIORITY\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_TASK\_PRIORITY\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_SWAPOUT\_TASK\_PRIORITY\_DEFAULT}{RTEMS\_BDBUF\_SWAPOUT\_TASK\_PRIORITY\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT~15}

Default swap-\/out task priority. \mbox{\Hypertarget{group__rtems__bdbuf_ga2286d9fcac2fdd6f19497da7faa82f81}\label{group__rtems__bdbuf_ga2286d9fcac2fdd6f19497da7faa82f81}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_SWAPOUT\_TASK\_SWAP\_PERIOD\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_TASK\_SWAP\_PERIOD\_DEFAULT}}
\index{RTEMS\_BDBUF\_SWAPOUT\_TASK\_SWAP\_PERIOD\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_TASK\_SWAP\_PERIOD\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_SWAPOUT\_TASK\_SWAP\_PERIOD\_DEFAULT}{RTEMS\_BDBUF\_SWAPOUT\_TASK\_SWAP\_PERIOD\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+S\+W\+A\+P\+\_\+\+P\+E\+R\+I\+O\+D\+\_\+\+D\+E\+F\+A\+U\+LT~250}

Default swap-\/out task swap period in milli seconds. \mbox{\Hypertarget{group__rtems__bdbuf_ga49a9f2ff52d57ceb4f3897da82942fee}\label{group__rtems__bdbuf_ga49a9f2ff52d57ceb4f3897da82942fee}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASK\_PRIORITY\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASK\_PRIORITY\_DEFAULT}}
\index{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASK\_PRIORITY\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASK\_PRIORITY\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASK\_PRIORITY\_DEFAULT}{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASK\_PRIORITY\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+W\+O\+R\+K\+E\+R\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT~\mbox{\hyperlink{group__rtems__bdbuf_ga4389b6ef4328f397e91288e8479a944c}{R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+T\+A\+S\+K\+\_\+\+P\+R\+I\+O\+R\+I\+T\+Y\+\_\+\+D\+E\+F\+A\+U\+LT}}}

Default swap-\/out worker task priority. The same as the swap-\/out task. \mbox{\Hypertarget{group__rtems__bdbuf_ga43a9167effd55601db78237e927c0288}\label{group__rtems__bdbuf_ga43a9167effd55601db78237e927c0288}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASKS\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASKS\_DEFAULT}}
\index{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASKS\_DEFAULT@{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASKS\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASKS\_DEFAULT}{RTEMS\_BDBUF\_SWAPOUT\_WORKER\_TASKS\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+W\+A\+P\+O\+U\+T\+\_\+\+W\+O\+R\+K\+E\+R\+\_\+\+T\+A\+S\+K\+S\+\_\+\+D\+E\+F\+A\+U\+LT~0}

Default swap-\/out worker tasks. Currently disabled. \mbox{\Hypertarget{group__rtems__bdbuf_ga39a54490a2930a1a321c5b06cc5e3e54}\label{group__rtems__bdbuf_ga39a54490a2930a1a321c5b06cc5e3e54}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_TASK\_STACK\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_TASK\_STACK\_SIZE\_DEFAULT}}
\index{RTEMS\_BDBUF\_TASK\_STACK\_SIZE\_DEFAULT@{RTEMS\_BDBUF\_TASK\_STACK\_SIZE\_DEFAULT}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{RTEMS\_BDBUF\_TASK\_STACK\_SIZE\_DEFAULT}{RTEMS\_BDBUF\_TASK\_STACK\_SIZE\_DEFAULT}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+T\+A\+S\+K\+\_\+\+S\+T\+A\+C\+K\+\_\+\+S\+I\+Z\+E\+\_\+\+D\+E\+F\+A\+U\+LT~\mbox{\hyperlink{group__RTEMSAPIClassic_ga2e35188053c5e97a85df8e3aa4d23d2f}{R\+T\+E\+M\+S\+\_\+\+M\+I\+N\+I\+M\+U\+M\+\_\+\+S\+T\+A\+C\+K\+\_\+\+S\+I\+ZE}}}

Default task stack size for swap-\/out and worker tasks. 

\subsection{Typedef Documentation}
\mbox{\Hypertarget{group__rtems__bdbuf_gacce5a2661bea8023c1b5097f7566f051}\label{group__rtems__bdbuf_gacce5a2661bea8023c1b5097f7566f051}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_buffer@{rtems\_bdbuf\_buffer}}
\index{rtems\_bdbuf\_buffer@{rtems\_bdbuf\_buffer}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_buffer}{rtems\_bdbuf\_buffer}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}}  \mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}}}

To manage buffers we using buffer descriptors (BD). A BD holds a buffer plus a range of other information related to managing the buffer in the cache. To speed-\/up buffer lookup descriptors are organized in A\+V\+L-\/\+Tree. The fields \textquotesingle{}dd\textquotesingle{} and \textquotesingle{}block\textquotesingle{} are search keys. \mbox{\Hypertarget{group__rtems__bdbuf_gaf4f5fc331dd33379471c78d5459c69f7}\label{group__rtems__bdbuf_gaf4f5fc331dd33379471c78d5459c69f7}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_config@{rtems\_bdbuf\_config}}
\index{rtems\_bdbuf\_config@{rtems\_bdbuf\_config}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_config}{rtems\_bdbuf\_config}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structrtems__bdbuf__config}{rtems\+\_\+bdbuf\+\_\+config}}  \mbox{\hyperlink{structrtems__bdbuf__config}{rtems\+\_\+bdbuf\+\_\+config}}}

Buffering configuration definition. See \mbox{\hyperlink{confdefs_8h}{confdefs.\+h}} for support on using this structure. 

\subsection{Enumeration Type Documentation}
\mbox{\Hypertarget{group__rtems__bdbuf_ga0169f36547d36f0723b6456172eeef0a}\label{group__rtems__bdbuf_ga0169f36547d36f0723b6456172eeef0a}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_buf\_state@{rtems\_bdbuf\_buf\_state}}
\index{rtems\_bdbuf\_buf\_state@{rtems\_bdbuf\_buf\_state}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_buf\_state}{rtems\_bdbuf\_buf\_state}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{group__rtems__bdbuf_ga0169f36547d36f0723b6456172eeef0a}{rtems\+\_\+bdbuf\+\_\+buf\+\_\+state}}}



State of a buffer of the cache. 

The state has several implications. Depending on the state a buffer can be in the A\+VL tree, in a list, in use by an entity and a group user or not.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{8}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ State}&\cellcolor{\tableheadbgcolor}\textbf{ Valid Data}&\cellcolor{\tableheadbgcolor}\textbf{ A\+VL Tree }&\cellcolor{\tableheadbgcolor}\textbf{ L\+RU List}&\cellcolor{\tableheadbgcolor}\textbf{ Modified List}&\cellcolor{\tableheadbgcolor}\textbf{ Synchronization List }&\cellcolor{\tableheadbgcolor}\textbf{ Group User}&\cellcolor{\tableheadbgcolor}\textbf{ External User  }\\\cline{1-8}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ State}&\cellcolor{\tableheadbgcolor}\textbf{ Valid Data}&\cellcolor{\tableheadbgcolor}\textbf{ A\+VL Tree }&\cellcolor{\tableheadbgcolor}\textbf{ L\+RU List}&\cellcolor{\tableheadbgcolor}\textbf{ Modified List}&\cellcolor{\tableheadbgcolor}\textbf{ Synchronization List }&\cellcolor{\tableheadbgcolor}\textbf{ Group User}&\cellcolor{\tableheadbgcolor}\textbf{ External User  }\\\cline{1-8}
\endhead
F\+R\+EE&&&X&&&&\\\cline{1-8}
E\+M\+P\+TY&&X &&&&&\\\cline{1-8}
C\+A\+C\+H\+ED&X&X &X&&&&\\\cline{1-8}
A\+C\+C\+E\+SS C\+A\+C\+H\+ED&X&X &&&&X&X  \\\cline{1-8}
A\+C\+C\+E\+SS M\+O\+D\+I\+F\+I\+ED&X&X &&&&X&X  \\\cline{1-8}
A\+C\+C\+E\+SS E\+M\+P\+TY&&X &&&&X&X  \\\cline{1-8}
A\+C\+C\+E\+SS P\+U\+R\+G\+ED&&X &&&&X&X  \\\cline{1-8}
M\+O\+D\+I\+F\+I\+ED&X&X &&X&&X&\\\cline{1-8}
S\+Y\+NC&X&X &&&X&X&\\\cline{1-8}
T\+R\+A\+N\+S\+F\+ER&X&X &&&&X&X  \\\cline{1-8}
T\+R\+A\+N\+S\+F\+ER P\+U\+R\+G\+ED&&X &&&&X&X  \\\cline{1-8}
\end{longtabu}
\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_FREE@{RTEMS\_BDBUF\_STATE\_FREE}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_FREE@{RTEMS\_BDBUF\_STATE\_FREE}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa71f15d80aec284191be9dd7aa16ba12c}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa71f15d80aec284191be9dd7aa16ba12c}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+F\+R\+EE&Free. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_EMPTY@{RTEMS\_BDBUF\_STATE\_EMPTY}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_EMPTY@{RTEMS\_BDBUF\_STATE\_EMPTY}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aaf20ea6300aa6f0c306411e459e346655}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aaf20ea6300aa6f0c306411e459e346655}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+E\+M\+P\+TY&Empty. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_CACHED@{RTEMS\_BDBUF\_STATE\_CACHED}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_CACHED@{RTEMS\_BDBUF\_STATE\_CACHED}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aac3b227c132567db236f300a26b092a69}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aac3b227c132567db236f300a26b092a69}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+A\+C\+H\+ED&Cached. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_ACCESS\_CACHED@{RTEMS\_BDBUF\_STATE\_ACCESS\_CACHED}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_ACCESS\_CACHED@{RTEMS\_BDBUF\_STATE\_ACCESS\_CACHED}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa366b8d851fe5a11f4733c00b1409df7d}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa366b8d851fe5a11f4733c00b1409df7d}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+C\+A\+C\+H\+ED&Accessed by upper layer with cached data. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_ACCESS\_MODIFIED@{RTEMS\_BDBUF\_STATE\_ACCESS\_MODIFIED}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_ACCESS\_MODIFIED@{RTEMS\_BDBUF\_STATE\_ACCESS\_MODIFIED}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aab079a61b153c4b0313bcc2a788131e02}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aab079a61b153c4b0313bcc2a788131e02}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+M\+O\+D\+I\+F\+I\+ED&Accessed by upper layer with modified data. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_ACCESS\_EMPTY@{RTEMS\_BDBUF\_STATE\_ACCESS\_EMPTY}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_ACCESS\_EMPTY@{RTEMS\_BDBUF\_STATE\_ACCESS\_EMPTY}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa4939e1384db29ded8d98dff95580a4ed}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa4939e1384db29ded8d98dff95580a4ed}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+E\+M\+P\+TY&Accessed by upper layer with invalid data. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_ACCESS\_PURGED@{RTEMS\_BDBUF\_STATE\_ACCESS\_PURGED}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_ACCESS\_PURGED@{RTEMS\_BDBUF\_STATE\_ACCESS\_PURGED}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa4ae71d01cced39a3dc2339a68d5fdb3c}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa4ae71d01cced39a3dc2339a68d5fdb3c}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+C\+C\+E\+S\+S\+\_\+\+P\+U\+R\+G\+ED&Accessed by upper layer with purged data. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_MODIFIED@{RTEMS\_BDBUF\_STATE\_MODIFIED}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_MODIFIED@{RTEMS\_BDBUF\_STATE\_MODIFIED}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aad4ad56ebb96642f2c35a59d50e04cdc8}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aad4ad56ebb96642f2c35a59d50e04cdc8}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+M\+O\+D\+I\+F\+I\+ED&Modified by upper layer. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_SYNC@{RTEMS\_BDBUF\_STATE\_SYNC}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_SYNC@{RTEMS\_BDBUF\_STATE\_SYNC}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa2c826ea2246ca7a4bab97a5879cbf99d}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa2c826ea2246ca7a4bab97a5879cbf99d}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+S\+Y\+NC&Scheduled for synchronization. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_TRANSFER@{RTEMS\_BDBUF\_STATE\_TRANSFER}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_TRANSFER@{RTEMS\_BDBUF\_STATE\_TRANSFER}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa50fc56fabf62a4753588ad64aabb2c9c}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aa50fc56fabf62a4753588ad64aabb2c9c}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+R\+A\+N\+S\+F\+ER&In transfer by block device driver. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{RTEMS\_BDBUF\_STATE\_TRANSFER\_PURGED@{RTEMS\_BDBUF\_STATE\_TRANSFER\_PURGED}!Block Device Buffer Management@{Block Device Buffer Management}}\index{Block Device Buffer Management@{Block Device Buffer Management}!RTEMS\_BDBUF\_STATE\_TRANSFER\_PURGED@{RTEMS\_BDBUF\_STATE\_TRANSFER\_PURGED}}}\mbox{\Hypertarget{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aacef35ec154e4f4fe26262af3ed685ca7}\label{group__rtems__bdbuf_gga0169f36547d36f0723b6456172eeef0aacef35ec154e4f4fe26262af3ed685ca7}} 
R\+T\+E\+M\+S\+\_\+\+B\+D\+B\+U\+F\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+R\+A\+N\+S\+F\+E\+R\+\_\+\+P\+U\+R\+G\+ED&In transfer by block device driver and purged. \\
\hline

\end{DoxyEnumFields}


\subsection{Function Documentation}
\mbox{\Hypertarget{group__rtems__bdbuf_ga05fa34cc25ade6d09797b0dc88cf33e1}\label{group__rtems__bdbuf_ga05fa34cc25ade6d09797b0dc88cf33e1}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_get@{rtems\_bdbuf\_get}}
\index{rtems\_bdbuf\_get@{rtems\_bdbuf\_get}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_get()}{rtems\_bdbuf\_get()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+get (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$}]{dd,  }\item[{\mbox{\hyperlink{group__rtems__disk_ga5fbcfd40b657bff6c54d9e393fab3274}{rtems\+\_\+blkdev\+\_\+bnum}}}]{block,  }\item[{\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$$\ast$}]{bd }\end{DoxyParamCaption})}

Get block buffer for data to be written into. The buffers is set to the access or modified access state. If the buffer is in the cache and modified the state is access modified else the state is access. This buffer contents are not initialised if the buffer is not already in the cache. If the block is already resident in memory it is returned how-\/ever if not in memory the buffer is not read from disk. This call is used when writing the whole block on a disk rather than just changing a part of it. If there is no buffers available this call will block. A buffer obtained with this call will not be involved in a transfer request and will not be returned to another user until released. If the buffer is already with a user when this call is made the call is blocked until the buffer is returned. The highest priority waiter will obtain the buffer first.

The block number is the linear block number. This is relative to the start of the partition on the media.

Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em dd} & \mbox{[}in\mbox{]} The disk device. \\
\hline
{\em block} & \mbox{[}in\mbox{]} Linear media block number. \\
\hline
{\em bd} & \mbox{[}out\mbox{]} Reference to the buffer descriptor pointer.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+ID} & Invalid block number. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}\label{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_init@{rtems\_bdbuf\_init}}
\index{rtems\_bdbuf\_init@{rtems\_bdbuf\_init}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_init()}{rtems\_bdbuf\_init()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Prepare buffering layer to work -\/ initialize buffer descritors and (if it is neccessary) buffers. After initialization all blocks is placed into the ready state.


\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+C\+A\+L\+L\+E\+D\+\_\+\+F\+R\+O\+M\+\_\+\+I\+SR} & Called from an interrupt context. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+N\+U\+M\+B\+ER} & The buffer maximum is not an integral multiple of the buffer minimum. The maximum read-\/ahead blocks count is too large. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+R\+E\+S\+O\+U\+R\+C\+E\+\_\+\+I\+N\+\_\+\+U\+SE} & Already initialized. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+U\+N\+S\+A\+T\+I\+S\+F\+I\+ED} & Not enough resources. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_gadc7712bcd488ea249f4a84d362126d46}\label{group__rtems__bdbuf_gadc7712bcd488ea249f4a84d362126d46}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_purge\_dev@{rtems\_bdbuf\_purge\_dev}}
\index{rtems\_bdbuf\_purge\_dev@{rtems\_bdbuf\_purge\_dev}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_purge\_dev()}{rtems\_bdbuf\_purge\_dev()}}
{\footnotesize\ttfamily void rtems\+\_\+bdbuf\+\_\+purge\+\_\+dev (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$}]{dd }\end{DoxyParamCaption})}



Purges all buffers corresponding to the disk device {\itshape dd}. 

This may result in loss of data. The read-\/ahead state of this device is reset.

Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em dd} & \mbox{[}in\mbox{]} The disk device. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{group__rtems__bdbuf_ga8546cefc842eef10cdb5b38a6cead9f7}\label{group__rtems__bdbuf_ga8546cefc842eef10cdb5b38a6cead9f7}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_read@{rtems\_bdbuf\_read}}
\index{rtems\_bdbuf\_read@{rtems\_bdbuf\_read}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_read()}{rtems\_bdbuf\_read()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+read (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$}]{dd,  }\item[{\mbox{\hyperlink{group__rtems__disk_ga5fbcfd40b657bff6c54d9e393fab3274}{rtems\+\_\+blkdev\+\_\+bnum}}}]{block,  }\item[{\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$$\ast$}]{bd }\end{DoxyParamCaption})}

Get the block buffer and if not already in the cache read from the disk. If specified block already cached return. The buffer is set to the access or modified access state. If the buffer is in the cache and modified the state is access modified else the state is access. If block is already being read from disk for being written to disk this call blocks. If the buffer is waiting to be written it is removed from modified queue and returned to the user. If the buffer is not in the cache a new buffer is obtained and the data read from disk. The call may block until these operations complete. A buffer obtained with this call will not be involved in a transfer request and will not be returned to another user until released. If the buffer is already with a user when this call is made the call is blocked until the buffer is returned. The highest priority waiter will obtain the buffer first.

Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em dd} & \mbox{[}in\mbox{]} The disk device. \\
\hline
{\em block} & \mbox{[}in\mbox{]} Linear media block number. \\
\hline
{\em bd} & \mbox{[}out\mbox{]} Reference to the buffer descriptor pointer.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+ID} & Invalid block number. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+O\+\_\+\+E\+R\+R\+OR} & \mbox{\hyperlink{structIO}{IO}} error. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_ga005a3a396079975d67eac6de5640d744}\label{group__rtems__bdbuf_ga005a3a396079975d67eac6de5640d744}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_release@{rtems\_bdbuf\_release}}
\index{rtems\_bdbuf\_release@{rtems\_bdbuf\_release}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_release()}{rtems\_bdbuf\_release()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+release (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$}]{bd }\end{DoxyParamCaption})}

Release the buffer obtained by a read call back to the cache. If the buffer was obtained by a get call and was not already in the cache the release modified call should be used. A buffer released with this call obtained by a get call may not be in sync with the contents on disk. If the buffer was in the cache and modified before this call it will be returned to the modified queue. The buffers is returned to the end of the L\+RU list.

Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em bd} & \mbox{[}in\mbox{]} Reference to the buffer descriptor. The buffer descriptor reference must not be {\ttfamily N\+U\+LL} and must be obtained via \mbox{\hyperlink{group__rtems__bdbuf_ga05fa34cc25ade6d09797b0dc88cf33e1}{rtems\+\_\+bdbuf\+\_\+get()}} or \mbox{\hyperlink{group__rtems__bdbuf_ga8546cefc842eef10cdb5b38a6cead9f7}{rtems\+\_\+bdbuf\+\_\+read()}}.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+D\+D\+R\+E\+SS} & The reference is N\+U\+LL. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_ga3f8af85cf0abcb0858811f74130aa6c7}\label{group__rtems__bdbuf_ga3f8af85cf0abcb0858811f74130aa6c7}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_release\_modified@{rtems\_bdbuf\_release\_modified}}
\index{rtems\_bdbuf\_release\_modified@{rtems\_bdbuf\_release\_modified}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_release\_modified()}{rtems\_bdbuf\_release\_modified()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+release\+\_\+modified (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$}]{bd }\end{DoxyParamCaption})}

Release the buffer allocated with a get or read call placing it on the modified list. If the buffer was not released modified before the hold timer is set to the configuration value. If the buffer had been released modified before but not written to disk the hold timer is not updated. The buffer will be written to disk when the hold timer has expired, there are not more buffers available in the cache and a get or read buffer needs one or a sync call has been made. If the buffer is obtained with a get or read before the hold timer has expired the buffer will be returned to the user.

Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em bd} & \mbox{[}in\mbox{]} Reference to the buffer descriptor. The buffer descriptor reference must not be {\ttfamily N\+U\+LL} and must be obtained via \mbox{\hyperlink{group__rtems__bdbuf_ga05fa34cc25ade6d09797b0dc88cf33e1}{rtems\+\_\+bdbuf\+\_\+get()}} or \mbox{\hyperlink{group__rtems__bdbuf_ga8546cefc842eef10cdb5b38a6cead9f7}{rtems\+\_\+bdbuf\+\_\+read()}}.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+D\+D\+R\+E\+SS} & The reference is N\+U\+LL. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_ga649b3b4fb368921f579a0204552a7a60}\label{group__rtems__bdbuf_ga649b3b4fb368921f579a0204552a7a60}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_set\_block\_size@{rtems\_bdbuf\_set\_block\_size}}
\index{rtems\_bdbuf\_set\_block\_size@{rtems\_bdbuf\_set\_block\_size}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_set\_block\_size()}{rtems\_bdbuf\_set\_block\_size()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+set\+\_\+block\+\_\+size (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$}]{dd,  }\item[{uint32\+\_\+t}]{block\+\_\+size,  }\item[{bool}]{sync }\end{DoxyParamCaption})}



Sets the block size of a disk device. 

This will set the block size derived fields of the disk device. If requested the disk device is synchronized before the block size change occurs. Since the cache is unlocked during the synchronization operation some tasks may access the disk device in the meantime. This may result in loss of data. After the synchronization the disk device is purged to ensure a consistent cache state and the block size change occurs. This also resets the read-\/ahead state of this disk device. Due to the purge operation this may result in loss of data.

Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em dd} & \mbox{[}in, out\mbox{]} The disk device. \\
\hline
{\em block\+\_\+size} & \mbox{[}in\mbox{]} The new block size in bytes. \\
\hline
{\em sync} & \mbox{[}in\mbox{]} If {\ttfamily true}, then synchronize the disk device before the block size change.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+N\+U\+M\+B\+ER} & Invalid block size. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_ga9a49c1519760b60eace0463277af50ee}\label{group__rtems__bdbuf_ga9a49c1519760b60eace0463277af50ee}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_sync@{rtems\_bdbuf\_sync}}
\index{rtems\_bdbuf\_sync@{rtems\_bdbuf\_sync}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_sync()}{rtems\_bdbuf\_sync()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+sync (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__bdbuf__buffer}{rtems\+\_\+bdbuf\+\_\+buffer}} $\ast$}]{bd }\end{DoxyParamCaption})}

Release the buffer as modified and wait until it has been synchronized with the disk by writing it. This buffer will be the first to be transfer to disk and other buffers may also be written if the maximum number of blocks in a requests allows it.

\begin{DoxyNote}{Note}
This code does not lock the sync mutex and stop additions to the modified queue.
\end{DoxyNote}
Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em bd} & \mbox{[}in\mbox{]} Reference to the buffer descriptor. The buffer descriptor reference must not be {\ttfamily N\+U\+LL} and must be obtained via \mbox{\hyperlink{group__rtems__bdbuf_ga05fa34cc25ade6d09797b0dc88cf33e1}{rtems\+\_\+bdbuf\+\_\+get()}} or \mbox{\hyperlink{group__rtems__bdbuf_ga8546cefc842eef10cdb5b38a6cead9f7}{rtems\+\_\+bdbuf\+\_\+read()}}.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+D\+D\+R\+E\+SS} & The reference is N\+U\+LL. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__rtems__bdbuf_ga1f02deb0d0ca33a6b9da04b9f3f2078d}\label{group__rtems__bdbuf_ga1f02deb0d0ca33a6b9da04b9f3f2078d}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_syncdev@{rtems\_bdbuf\_syncdev}}
\index{rtems\_bdbuf\_syncdev@{rtems\_bdbuf\_syncdev}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_syncdev()}{rtems\_bdbuf\_syncdev()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+bdbuf\+\_\+syncdev (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structrtems__disk__device}{rtems\+\_\+disk\+\_\+device}} $\ast$}]{dd }\end{DoxyParamCaption})}

Synchronize all modified buffers for this device with the disk and wait until the transfers have completed. The sync mutex for the cache is locked stopping the addition of any further modified buffers. It is only the currently modified buffers that are written.

\begin{DoxyNote}{Note}
Nesting calls to sync multiple devices will be handled sequentially. A nested call will be blocked until the first sync request has complete.
\end{DoxyNote}
Before you can use this function, the \mbox{\hyperlink{group__rtems__bdbuf_gaf19ee8ba7815e24767b6a91e200a78bc}{rtems\+\_\+bdbuf\+\_\+init()}} routine must be called at least once to initialize the cache, otherwise a fatal error will occur.


\begin{DoxyParams}{Parameters}
{\em dd} & \mbox{[}in\mbox{]} The disk device.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Successful operation. \\
\hline
\end{DoxyRetVals}


\subsection{Variable Documentation}
\mbox{\Hypertarget{group__rtems__bdbuf_gac1ab295c43675e17b20a7af3956c2a72}\label{group__rtems__bdbuf_gac1ab295c43675e17b20a7af3956c2a72}} 
\index{Block Device Buffer Management@{Block Device Buffer Management}!rtems\_bdbuf\_configuration@{rtems\_bdbuf\_configuration}}
\index{rtems\_bdbuf\_configuration@{rtems\_bdbuf\_configuration}!Block Device Buffer Management@{Block Device Buffer Management}}
\subsubsection{\texorpdfstring{rtems\_bdbuf\_configuration}{rtems\_bdbuf\_configuration}}
{\footnotesize\ttfamily const \mbox{\hyperlink{structrtems__bdbuf__config}{rtems\+\_\+bdbuf\+\_\+config}} rtems\+\_\+bdbuf\+\_\+configuration}

External reference to the configuration.

The configuration is provided by the application. 