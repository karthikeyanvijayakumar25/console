\hypertarget{nvdisk_8h}{}\section{cpukit/include/rtems/nvdisk.h File Reference}
\label{nvdisk_8h}\index{cpukit/include/rtems/nvdisk.h@{cpukit/include/rtems/nvdisk.h}}


Non-\/volatile Disk Block Device Implementation.  


{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$sys/ioctl.\+h$>$}\newline
{\ttfamily \#include $<$rtems.\+h$>$}\newline
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structrtems__nvdisk__monitor__data}{rtems\+\_\+nvdisk\+\_\+monitor\+\_\+data}}
\item 
struct \mbox{\hyperlink{structrtems__nvdisk__driver__handlers}{rtems\+\_\+nvdisk\+\_\+driver\+\_\+handlers}}
\item 
struct \mbox{\hyperlink{structrtems__nvdisk__device__desc}{rtems\+\_\+nvdisk\+\_\+device\+\_\+desc}}
\item 
struct \mbox{\hyperlink{structrtems__nvdisk__config}{rtems\+\_\+nvdisk\+\_\+config}}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{nvdisk_8h_afc5adb282582fe0738e28afa414df576}{R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+D\+E\+V\+I\+C\+E\+\_\+\+B\+A\+S\+E\+\_\+\+N\+A\+ME}}~\char`\"{}/dev/nvd\char`\"{}
\item 
\#define \mbox{\hyperlink{nvdisk_8h_a822f0fd08a60d474902ed44abee3eed9}{R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+I\+O\+C\+T\+L\+\_\+\+E\+R\+A\+S\+E\+\_\+\+D\+I\+SK}}~\+\_\+\+IO(\textquotesingle{}B\textquotesingle{}, 128)
\item 
\mbox{\Hypertarget{nvdisk_8h_a2694985b0630a8897196e73dfc170b5f}\label{nvdisk_8h_a2694985b0630a8897196e73dfc170b5f}} 
\#define {\bfseries R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+I\+O\+C\+T\+L\+\_\+\+M\+O\+N\+I\+T\+O\+R\+I\+NG}~\+\_\+\+IO(\textquotesingle{}B\textquotesingle{}, 129)
\item 
\mbox{\Hypertarget{nvdisk_8h_a0afd888229dd4f0000fd3644641aa775}\label{nvdisk_8h_a0afd888229dd4f0000fd3644641aa775}} 
\#define {\bfseries R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+I\+O\+C\+T\+L\+\_\+\+I\+N\+F\+O\+\_\+\+L\+E\+V\+EL}~\+\_\+\+IO(\textquotesingle{}B\textquotesingle{}, 130)
\item 
\mbox{\Hypertarget{nvdisk_8h_a007bbb94f233b214b103b0bc511d04cd}\label{nvdisk_8h_a007bbb94f233b214b103b0bc511d04cd}} 
\#define {\bfseries R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+I\+O\+C\+T\+L\+\_\+\+P\+R\+I\+N\+T\+\_\+\+S\+T\+A\+T\+US}~\+\_\+\+IO(\textquotesingle{}B\textquotesingle{}, 131)
\item 
\#define \mbox{\hyperlink{nvdisk_8h_ab3ede4e1ff6372afea4cbb6487094cf2}{R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+K\+B\+Y\+T\+ES}}(\+\_\+k)~((\+\_\+k) $\ast$ 1024)
\item 
\#define \mbox{\hyperlink{nvdisk_8h_abe33d3b279e349def4ff169c7d015c70}{R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+A\+G\+ES}}~(1 $<$$<$ 0)
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \mbox{\hyperlink{structrtems__nvdisk__monitor__data}{rtems\+\_\+nvdisk\+\_\+monitor\+\_\+data}} \mbox{\hyperlink{nvdisk_8h_a90583cc50f4b5b6296cd09e72ba6d543}{rtems\+\_\+nvdisk\+\_\+monitor\+\_\+data}}
\item 
typedef struct \mbox{\hyperlink{structrtems__nvdisk__driver__handlers}{rtems\+\_\+nvdisk\+\_\+driver\+\_\+handlers}} \mbox{\hyperlink{nvdisk_8h_af5464925ffcdc851e524cafb83b2abf7}{rtems\+\_\+nvdisk\+\_\+driver\+\_\+handlers}}
\item 
typedef struct \mbox{\hyperlink{structrtems__nvdisk__device__desc}{rtems\+\_\+nvdisk\+\_\+device\+\_\+desc}} \mbox{\hyperlink{nvdisk_8h_acba595e1450a0b7c1550596f40b613fc}{rtems\+\_\+nvdisk\+\_\+device\+\_\+desc}}
\item 
typedef struct \mbox{\hyperlink{structrtems__nvdisk__config}{rtems\+\_\+nvdisk\+\_\+config}} \mbox{\hyperlink{nvdisk_8h_ad9d5584c360492779e1ecf160198a099}{rtems\+\_\+nvdisk\+\_\+config}}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+device\+\_\+driver}} \mbox{\hyperlink{nvdisk_8h_a5463eee7b59fa8eebf5d6443d19889ca}{rtems\+\_\+nvdisk\+\_\+initialize}} (rtems\+\_\+device\+\_\+major\+\_\+number major, rtems\+\_\+device\+\_\+minor\+\_\+number minor, void $\ast$arg)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \mbox{\hyperlink{structrtems__nvdisk__config}{rtems\+\_\+nvdisk\+\_\+config}} \mbox{\hyperlink{nvdisk_8h_a29a481d044d43c62aa481afb806cfbe2}{rtems\+\_\+nvdisk\+\_\+configuration}} \mbox{[}$\,$\mbox{]}
\item 
uint32\+\_\+t \mbox{\hyperlink{nvdisk_8h_ab13d3f48de161cea6eb2ec21b10de4c5}{rtems\+\_\+nvdisk\+\_\+configuration\+\_\+size}}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Non-\/volatile Disk Block Device Implementation. 



\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{nvdisk_8h_abe33d3b279e349def4ff169c7d015c70}\label{nvdisk_8h_abe33d3b279e349def4ff169c7d015c70}} 
\index{nvdisk.h@{nvdisk.h}!RTEMS\_NVDISK\_CHECK\_PAGES@{RTEMS\_NVDISK\_CHECK\_PAGES}}
\index{RTEMS\_NVDISK\_CHECK\_PAGES@{RTEMS\_NVDISK\_CHECK\_PAGES}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{RTEMS\_NVDISK\_CHECK\_PAGES}{RTEMS\_NVDISK\_CHECK\_PAGES}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+A\+G\+ES~(1 $<$$<$ 0)}

Check the pages during initialisation to see which pages are valid and which are not. This could slow down initialising the disk driver. \mbox{\Hypertarget{nvdisk_8h_afc5adb282582fe0738e28afa414df576}\label{nvdisk_8h_afc5adb282582fe0738e28afa414df576}} 
\index{nvdisk.h@{nvdisk.h}!RTEMS\_NVDISK\_DEVICE\_BASE\_NAME@{RTEMS\_NVDISK\_DEVICE\_BASE\_NAME}}
\index{RTEMS\_NVDISK\_DEVICE\_BASE\_NAME@{RTEMS\_NVDISK\_DEVICE\_BASE\_NAME}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{RTEMS\_NVDISK\_DEVICE\_BASE\_NAME}{RTEMS\_NVDISK\_DEVICE\_BASE\_NAME}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+D\+E\+V\+I\+C\+E\+\_\+\+B\+A\+S\+E\+\_\+\+N\+A\+ME~\char`\"{}/dev/nvd\char`\"{}}

The Non-\/volatile disk provides a simple directly mapped disk driver with checksums for each. It is designed to provied a disk that can survive a restart. Examples are E\+E\+P\+R\+OM devices which have byte writeable locations, or a battery backed up R\+AM disk.

The low level driver provides the physical access to the hardware.\+The base name of the nv disks. \mbox{\Hypertarget{nvdisk_8h_a822f0fd08a60d474902ed44abee3eed9}\label{nvdisk_8h_a822f0fd08a60d474902ed44abee3eed9}} 
\index{nvdisk.h@{nvdisk.h}!RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK@{RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK}}
\index{RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK@{RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK}{RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+I\+O\+C\+T\+L\+\_\+\+E\+R\+A\+S\+E\+\_\+\+D\+I\+SK~\+\_\+\+IO(\textquotesingle{}B\textquotesingle{}, 128)}

NV disk specific ioctl request types. To use open the device and issue the ioctl call.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} fd = \mbox{\hyperlink{open_8c_a62e93eb794fed24c0f46c6acda6ea510}{open}} (\textcolor{stringliteral}{"/dev/nvdisk0"}, O\_WRONLY, 0);}
\DoxyCodeLine{\textcolor{keywordflow}{if} (fd < 0)}
\DoxyCodeLine{\{}
\DoxyCodeLine{  printf (\textcolor{stringliteral}{"driver open failed: \%s\(\backslash\)n"}, strerror (errno));}
\DoxyCodeLine{  exit (1);}
\DoxyCodeLine{\}}
\DoxyCodeLine{\textcolor{keywordflow}{if} (ioctl (fd, \mbox{\hyperlink{nvdisk_8h_a822f0fd08a60d474902ed44abee3eed9}{RTEMS\_NVDISK\_IOCTL\_ERASE\_DISK}}) < 0)}
\DoxyCodeLine{\{}
\DoxyCodeLine{  printf (\textcolor{stringliteral}{"driver erase failed: \%s\(\backslash\)n"}, strerror (errno));}
\DoxyCodeLine{  exit (1);}
\DoxyCodeLine{\}}
\DoxyCodeLine{close (fd);}
\end{DoxyCode}
 \mbox{\Hypertarget{nvdisk_8h_ab3ede4e1ff6372afea4cbb6487094cf2}\label{nvdisk_8h_ab3ede4e1ff6372afea4cbb6487094cf2}} 
\index{nvdisk.h@{nvdisk.h}!RTEMS\_NVDISK\_KBYTES@{RTEMS\_NVDISK\_KBYTES}}
\index{RTEMS\_NVDISK\_KBYTES@{RTEMS\_NVDISK\_KBYTES}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{RTEMS\_NVDISK\_KBYTES}{RTEMS\_NVDISK\_KBYTES}}
{\footnotesize\ttfamily \#define R\+T\+E\+M\+S\+\_\+\+N\+V\+D\+I\+S\+K\+\_\+\+K\+B\+Y\+T\+ES(\begin{DoxyParamCaption}\item[{}]{\+\_\+k }\end{DoxyParamCaption})~((\+\_\+k) $\ast$ 1024)}

Return the number of kilo-\/bytes. 

\subsection{Typedef Documentation}
\mbox{\Hypertarget{nvdisk_8h_ad9d5584c360492779e1ecf160198a099}\label{nvdisk_8h_ad9d5584c360492779e1ecf160198a099}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_config@{rtems\_nvdisk\_config}}
\index{rtems\_nvdisk\_config@{rtems\_nvdisk\_config}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_config}{rtems\_nvdisk\_config}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structrtems__nvdisk__config}{rtems\+\_\+nvdisk\+\_\+config}}  \mbox{\hyperlink{structrtems__nvdisk__config}{rtems\+\_\+nvdisk\+\_\+config}}}

R\+T\+E\+MS Non-\/\+Volatile Disk configuration table used to initialise the driver. \mbox{\Hypertarget{nvdisk_8h_acba595e1450a0b7c1550596f40b613fc}\label{nvdisk_8h_acba595e1450a0b7c1550596f40b613fc}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_device\_desc@{rtems\_nvdisk\_device\_desc}}
\index{rtems\_nvdisk\_device\_desc@{rtems\_nvdisk\_device\_desc}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_device\_desc}{rtems\_nvdisk\_device\_desc}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structrtems__nvdisk__device__desc}{rtems\+\_\+nvdisk\+\_\+device\+\_\+desc}}  \mbox{\hyperlink{structrtems__nvdisk__device__desc}{rtems\+\_\+nvdisk\+\_\+device\+\_\+desc}}}

NV Device Descriptor holds the description of a device that is part of the NV disk.

Typically this structure is part of a table of the device which is referenced in the nvdisk configuration table. The reference is kept in the driver and used all the time to manage the nv device, therefore it must always exist. \mbox{\Hypertarget{nvdisk_8h_af5464925ffcdc851e524cafb83b2abf7}\label{nvdisk_8h_af5464925ffcdc851e524cafb83b2abf7}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_driver\_handlers@{rtems\_nvdisk\_driver\_handlers}}
\index{rtems\_nvdisk\_driver\_handlers@{rtems\_nvdisk\_driver\_handlers}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_driver\_handlers}{rtems\_nvdisk\_driver\_handlers}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structrtems__nvdisk__driver__handlers}{rtems\+\_\+nvdisk\+\_\+driver\+\_\+handlers}}  \mbox{\hyperlink{structrtems__nvdisk__driver__handlers}{rtems\+\_\+nvdisk\+\_\+driver\+\_\+handlers}}}

NV Low Level driver handlers.

Typically this structure is part of a table of handlers in the device which is referenced in the nvdisk configuration table. The reference is kept in the driver and used all the time to manage the nv device, therefore it must always exist. \mbox{\Hypertarget{nvdisk_8h_a90583cc50f4b5b6296cd09e72ba6d543}\label{nvdisk_8h_a90583cc50f4b5b6296cd09e72ba6d543}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_monitor\_data@{rtems\_nvdisk\_monitor\_data}}
\index{rtems\_nvdisk\_monitor\_data@{rtems\_nvdisk\_monitor\_data}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_monitor\_data}{rtems\_nvdisk\_monitor\_data}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{structrtems__nvdisk__monitor__data}{rtems\+\_\+nvdisk\+\_\+monitor\+\_\+data}}  \mbox{\hyperlink{structrtems__nvdisk__monitor__data}{rtems\+\_\+nvdisk\+\_\+monitor\+\_\+data}}}

NV Disk Monitoring Data allows a user to obtain the current status of the disk. 

\subsection{Function Documentation}
\mbox{\Hypertarget{nvdisk_8h_a5463eee7b59fa8eebf5d6443d19889ca}\label{nvdisk_8h_a5463eee7b59fa8eebf5d6443d19889ca}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_initialize@{rtems\_nvdisk\_initialize}}
\index{rtems\_nvdisk\_initialize@{rtems\_nvdisk\_initialize}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_initialize()}{rtems\_nvdisk\_initialize()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+device\+\_\+driver}} rtems\+\_\+nvdisk\+\_\+initialize (\begin{DoxyParamCaption}\item[{rtems\+\_\+device\+\_\+major\+\_\+number}]{major,  }\item[{rtems\+\_\+device\+\_\+minor\+\_\+number}]{minor,  }\item[{void $\ast$}]{arg }\end{DoxyParamCaption})}

Non-\/volatile disk device driver initialization. Place in a table as the initialisation entry and remainder of the entries are the R\+T\+E\+MS block device generic handlers.


\begin{DoxyParams}{Parameters}
{\em major} & NV disk major device number. \\
\hline
{\em minor} & Minor device number, not applicable. \\
\hline
{\em arg} & Initialization argument, not applicable. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The rtems\+\_\+device\+\_\+driver is actually just rtems\+\_\+status\+\_\+code. 
\end{DoxyReturn}


\subsection{Variable Documentation}
\mbox{\Hypertarget{nvdisk_8h_a29a481d044d43c62aa481afb806cfbe2}\label{nvdisk_8h_a29a481d044d43c62aa481afb806cfbe2}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_configuration@{rtems\_nvdisk\_configuration}}
\index{rtems\_nvdisk\_configuration@{rtems\_nvdisk\_configuration}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_configuration}{rtems\_nvdisk\_configuration}}
{\footnotesize\ttfamily const \mbox{\hyperlink{structrtems__nvdisk__config}{rtems\+\_\+nvdisk\+\_\+config}} rtems\+\_\+nvdisk\+\_\+configuration\mbox{[}$\,$\mbox{]}}

External reference to the configuration. Please supply. Support is present in \mbox{\hyperlink{confdefs_8h}{confdefs.\+h}} for providing this variable. \mbox{\Hypertarget{nvdisk_8h_ab13d3f48de161cea6eb2ec21b10de4c5}\label{nvdisk_8h_ab13d3f48de161cea6eb2ec21b10de4c5}} 
\index{nvdisk.h@{nvdisk.h}!rtems\_nvdisk\_configuration\_size@{rtems\_nvdisk\_configuration\_size}}
\index{rtems\_nvdisk\_configuration\_size@{rtems\_nvdisk\_configuration\_size}!nvdisk.h@{nvdisk.h}}
\subsubsection{\texorpdfstring{rtems\_nvdisk\_configuration\_size}{rtems\_nvdisk\_configuration\_size}}
{\footnotesize\ttfamily uint32\+\_\+t rtems\+\_\+nvdisk\+\_\+configuration\+\_\+size}

External reference to the number of configurations. Please supply. Support is present in \mbox{\hyperlink{confdefs_8h}{confdefs.\+h}} for providing this variable. 