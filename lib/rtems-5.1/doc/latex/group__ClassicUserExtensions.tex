\hypertarget{group__ClassicUserExtensions}{}\section{User Extensions}
\label{group__ClassicUserExtensions}\index{User Extensions@{User Extensions}}


The User Extensions Manager allows the application developer to augment the executive by allowing them to supply extension routines which are invoked at critical system events.  


\subsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{extension_8h}{extension.\+h}}
\begin{DoxyCompactList}\small\item\em User Extensions A\+PI. \end{DoxyCompactList}\item 
file \mbox{\hyperlink{extension_8c}{extension.\+c}}
\begin{DoxyCompactList}\small\item\em Extension Manager Information with Zero Objects. \end{DoxyCompactList}\item 
file \mbox{\hyperlink{extensioncreate_8c}{extensioncreate.\+c}}
\begin{DoxyCompactList}\small\item\em User Extensions Implementation. \end{DoxyCompactList}\item 
file \mbox{\hyperlink{extensiondelete_8c}{extensiondelete.\+c}}
\begin{DoxyCompactList}\small\item\em User Extensions Implementation. \end{DoxyCompactList}\item 
file \mbox{\hyperlink{extensionident_8c}{extensionident.\+c}}
\begin{DoxyCompactList}\small\item\em User Extensions Implementation. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga9b49bbd00ea99449a4e4fc9b59c895eb}\label{group__ClassicUserExtensions_ga9b49bbd00ea99449a4e4fc9b59c895eb}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_gaa1841550f1837f2119ce895ad1b06861}{User\+\_\+extensions\+\_\+thread\+\_\+create\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+create\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga96cb5310a1aaccfadbd77f9ccb24c094}\label{group__ClassicUserExtensions_ga96cb5310a1aaccfadbd77f9ccb24c094}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_gac18e876b733325cf488b33a4a1c94558}{User\+\_\+extensions\+\_\+thread\+\_\+delete\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+delete\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_gacf732d4291173809fb6dc615d8168be8}\label{group__ClassicUserExtensions_gacf732d4291173809fb6dc615d8168be8}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_ga4924b5a161503c73ac1c894561fdd2b5}{User\+\_\+extensions\+\_\+thread\+\_\+start\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+start\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga5045805dde3cdecf26f7a9245f155703}\label{group__ClassicUserExtensions_ga5045805dde3cdecf26f7a9245f155703}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_ga2f53589bea8c67fd0f1fef2d2115479c}{User\+\_\+extensions\+\_\+thread\+\_\+restart\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+restart\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga2e7c0c52b69d46bce338779013b451e0}\label{group__ClassicUserExtensions_ga2e7c0c52b69d46bce338779013b451e0}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_gac8250042e8749b455941bf4085d09fc5}{User\+\_\+extensions\+\_\+thread\+\_\+switch\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+switch\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga378a249b196ccb591e5a04c757749c9c}\label{group__ClassicUserExtensions_ga378a249b196ccb591e5a04c757749c9c}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_ga4beea4d5417558969b343317683ab7c6}{User\+\_\+extensions\+\_\+thread\+\_\+begin\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+begin\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga061c1d4bf734f7b38eaeb23f16d8021d}\label{group__ClassicUserExtensions_ga061c1d4bf734f7b38eaeb23f16d8021d}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_ga876d6c2dd2ba0083ea94332a9438a91b}{User\+\_\+extensions\+\_\+thread\+\_\+exitted\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+exitted\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_gaa5f3d3bba6ca442724454eced0f2fdb8}\label{group__ClassicUserExtensions_gaa5f3d3bba6ca442724454eced0f2fdb8}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_gab9b016d654a82fef8666c465c2736a05}{User\+\_\+extensions\+\_\+fatal\+\_\+extension}} {\bfseries rtems\+\_\+fatal\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_gaa1dfb0f51ce2d26ee70c6f3983b76d7d}\label{group__ClassicUserExtensions_gaa1dfb0f51ce2d26ee70c6f3983b76d7d}} 
typedef \mbox{\hyperlink{group__RTEMSScoreUserExt_gab2e511a997080ca8050ac25a3bece8e4}{User\+\_\+extensions\+\_\+thread\+\_\+terminate\+\_\+extension}} {\bfseries rtems\+\_\+task\+\_\+terminate\+\_\+extension}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga8725f6c4d5d47572e2b3287c3667bb22}\label{group__ClassicUserExtensions_ga8725f6c4d5d47572e2b3287c3667bb22}} 
typedef \mbox{\hyperlink{structUser__extensions__Table}{User\+\_\+extensions\+\_\+\+Table}} {\bfseries rtems\+\_\+extensions\+\_\+table}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_gae8f714220940766490eef716665cb12d}\label{group__ClassicUserExtensions_gae8f714220940766490eef716665cb12d}} 
typedef \mbox{\hyperlink{group__RTEMSScoreIntErr_ga878b4de77df7d0b83d19609d4de42c26}{Internal\+\_\+errors\+\_\+\+Source}} {\bfseries rtems\+\_\+fatal\+\_\+source}
\item 
\mbox{\Hypertarget{group__ClassicUserExtensions_ga574eba3799b1b4843c1ebc04a240bb1e}\label{group__ClassicUserExtensions_ga574eba3799b1b4843c1ebc04a240bb1e}} 
typedef Internal\+\_\+errors\+\_\+t {\bfseries rtems\+\_\+fatal\+\_\+code}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__ClassicUserExtensions_gafcf5ccf8b70f2967ffbf8b493e278fbf}{rtems\+\_\+extension\+\_\+create}} (\mbox{\hyperlink{group__ClassicTasks_ga55fb63c49f68c0cbd9bee004da15b1fd}{rtems\+\_\+name}} name, const \mbox{\hyperlink{structUser__extensions__Table}{rtems\+\_\+extensions\+\_\+table}} $\ast$extension\+\_\+table, \mbox{\hyperlink{group__ClassicTasks_gab20892b814dced7dd4e5b9bf42becd57}{rtems\+\_\+id}} $\ast$id)
\begin{DoxyCompactList}\small\item\em Creates an extension set object. \end{DoxyCompactList}\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__ClassicUserExtensions_ga0286a5c091767c95c1eb1c80abca42d6}{rtems\+\_\+extension\+\_\+ident}} (\mbox{\hyperlink{group__ClassicTasks_ga55fb63c49f68c0cbd9bee004da15b1fd}{rtems\+\_\+name}} name, \mbox{\hyperlink{group__ClassicTasks_gab20892b814dced7dd4e5b9bf42becd57}{rtems\+\_\+id}} $\ast$id)
\begin{DoxyCompactList}\small\item\em Identifies an extension set object by a name. \end{DoxyCompactList}\item 
\mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} \mbox{\hyperlink{group__ClassicUserExtensions_ga0176b754e31634c92a0f206c0d7f2730}{rtems\+\_\+extension\+\_\+delete}} (\mbox{\hyperlink{group__ClassicTasks_gab20892b814dced7dd4e5b9bf42becd57}{rtems\+\_\+id}} id)
\begin{DoxyCompactList}\small\item\em Deletes an extension set object specified by the identifier {\itshape id}. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The User Extensions Manager allows the application developer to augment the executive by allowing them to supply extension routines which are invoked at critical system events. 

\hypertarget{group__ClassicUserExtensions_ClassicUserExtensionsSets}{}\subsection{Extension Sets}\label{group__ClassicUserExtensions_ClassicUserExtensionsSets}
An \mbox{\hyperlink{structUser__extensions__Table}{extension set}} is defined as a set of routines which are invoked at each of the critical system events at which user extension routines are invoked. Together a set of these routines typically perform a specific functionality such as performance monitoring or debugger support.

R\+T\+E\+MS allows the user to have multiple extension sets active at the same time. First, a single static extension set may be defined as the application\textquotesingle{}s User Extension Table which is included as part of the Configuration Table. This extension set is active for the entire life of the system and may not be deleted. This extension set is especially important because it is the only way the application can provided a fatal error extension which is invoked if R\+T\+E\+MS fails during the rtems\+\_\+initialize\+\_\+data\+\_\+structures() directive. The static extension set is optional and may be configured as {\ttfamily N\+U\+LL} if no static extension set is required.

Second, the user can install dynamic extensions using the \mbox{\hyperlink{group__ClassicUserExtensions_gafcf5ccf8b70f2967ffbf8b493e278fbf}{rtems\+\_\+extension\+\_\+create()}} directive. These extensions are R\+T\+E\+MS objects in that they have a name, an ID, and can be dynamically created and deleted. In contrast to the static extension set, these extensions can only be created and installed after the rtems\+\_\+initialize\+\_\+data\+\_\+structures() directive successfully completes execution. Dynamic extensions are useful for encapsulating the functionality of an extension set. For example, the application could use extensions to manage a special coprocessor, do performance monitoring, and to do stack bounds checking. Each of these extension sets could be written and installed independently of the others.

All user extensions are optional and R\+T\+E\+MS places no naming restrictions on the user. The user extension entry points are copied into an internal R\+T\+E\+MS structure. This means the user does not need to keep the table after creating it, and changing the handler entry points dynamically in a table once created has no effect. Creating a table local to a function can save space in space limited applications.

Extension switches do not effect the context switch overhead if no switch handler is installed.\hypertarget{group__ClassicUserExtensions_ClassicUserExtensionsTCB}{}\subsection{Task Control Block Area}\label{group__ClassicUserExtensions_ClassicUserExtensionsTCB}
R\+T\+E\+MS provides for a pointer to a user-\/defined data area for each extension set to be linked to each task\textquotesingle{}s control block (T\+CB). This area is only available for the dynamic extensions. This set of pointers is an extension of the T\+CB and can be used to store additional data required by the user\textquotesingle{}s extension functions.

The T\+CB extension is an array of pointers in the T\+CB. The index into the table can be obtained from the extension identifier returned when the extension is created\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{struct__Thread__Control}{rtems\_tcb}} *task = some\_task;}
\DoxyCodeLine{\textcolor{keywordtype}{size\_t} index = \mbox{\hyperlink{group__ClassicClassInfo_ga3a392f8dd107326289aecdf1543f0d94}{rtems\_object\_id\_get\_index}}(extension\_id);}
\DoxyCodeLine{\textcolor{keywordtype}{void} *extension\_data = task->\mbox{\hyperlink{struct__Thread__Control_ada69103bd5a31290709bde9d9c5aeff8}{extensions}} [index];}
\end{DoxyCode}


The number of pointers in the area is the same as the number of user extension sets configured. This allows an application to augment the T\+CB with user-\/defined information. For example, an application could implement task profiling by storing timing statistics in the T\+CB\textquotesingle{}s extended memory area. When a task context switch is being executed, the task switch extension could read a real-\/time clock to calculate how long the task being swapped out has run as well as timestamp the starting time for the task being swapped in.

If used, the extended memory area for the T\+CB should be allocated and the T\+CB extension pointer should be set at the time the task is created or started by either the task create or task start extension. The application is responsible for managing this extended memory area for the T\+C\+Bs. The memory may be reinitialized by the task restart extension and should be deallocated by the task delete extension when the task is deleted. Since the T\+CB extension buffers would most likely be of a fixed size, the R\+T\+E\+MS partition manager could be used to manage the application\textquotesingle{}s extended memory area. The application could create a partition of fixed size T\+CB extension buffers and use the partition manager\textquotesingle{}s allocation and deallocation directives to obtain and release the extension buffers.\hypertarget{group__ClassicUserExtensions_ClassicUserExtensionsOrder}{}\subsection{Order of Invokation}\label{group__ClassicUserExtensions_ClassicUserExtensionsOrder}
When one of the critical system events occur, the user extensions are invoked in either {\itshape forward} or {\itshape reverse} order. Forward order indicates that the static extension set is invoked followed by the dynamic extension sets in the order in which they were created. Reverse order means that the dynamic extension sets are invoked in the opposite of the order in which they were created followed by the static extension set. By invoking the extension sets in this order, extensions can be built upon one another. At the following system events, the extensions are invoked in forward order\+:


\begin{DoxyItemize}
\item Task creation
\item Task start
\item Task restart
\item Task context switch
\item Post task context switch
\item Task begins to execute
\end{DoxyItemize}

At the following system events, the extensions are invoked in reverse order\+:


\begin{DoxyItemize}
\item Task exit
\item Task deletion
\item Fatal error detection
\end{DoxyItemize}

At these system events, the extensions are invoked in reverse order to insure that if an extension set is built upon another, the more complicated extension is invoked before the extension set it is built upon. For example, by invoking the static extension set last it is known that the \char`\"{}system\char`\"{} fatal error extension will be the last fatal error extension executed. Another example is use of the task delete extension by the Standard C Library. Extension sets which are installed after the Standard C Library will operate correctly even if they utilize the C Library because the C Library\textquotesingle{}s task delete extension is invoked after that of the other extensions. 

\subsection{Function Documentation}
\mbox{\Hypertarget{group__ClassicUserExtensions_gafcf5ccf8b70f2967ffbf8b493e278fbf}\label{group__ClassicUserExtensions_gafcf5ccf8b70f2967ffbf8b493e278fbf}} 
\index{User Extensions@{User Extensions}!rtems\_extension\_create@{rtems\_extension\_create}}
\index{rtems\_extension\_create@{rtems\_extension\_create}!User Extensions@{User Extensions}}
\subsubsection{\texorpdfstring{rtems\_extension\_create()}{rtems\_extension\_create()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+extension\+\_\+create (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__ClassicTasks_ga55fb63c49f68c0cbd9bee004da15b1fd}{rtems\+\_\+name}}}]{name,  }\item[{const \mbox{\hyperlink{structUser__extensions__Table}{rtems\+\_\+extensions\+\_\+table}} $\ast$}]{extension\+\_\+table,  }\item[{\mbox{\hyperlink{group__ClassicTasks_gab20892b814dced7dd4e5b9bf42becd57}{rtems\+\_\+id}} $\ast$}]{id }\end{DoxyParamCaption})}



Creates an extension set object. 

This directive creates a extension set object from the extension table {\itshape extension\+\_\+table}. The assigned extension set identifier is returned in {\itshape id}. The identifier is used to access this extension set in other extension set related directives. The name {\itshape name} will be assigned to the extension set object.

Newly created extension sets are immediately installed and are invoked upon the next system event supporting an extension.

This directive will not cause the calling task to be preempted.


\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Extension set created successfully. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+D\+D\+R\+E\+SS} & Identifier pointer is {\ttfamily N\+U\+LL}. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+N\+A\+ME} & Invalid extension set name. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+T\+O\+O\+\_\+\+M\+A\+NY} & Too many extension sets created. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__ClassicUserExtensions_ga0176b754e31634c92a0f206c0d7f2730}\label{group__ClassicUserExtensions_ga0176b754e31634c92a0f206c0d7f2730}} 
\index{User Extensions@{User Extensions}!rtems\_extension\_delete@{rtems\_extension\_delete}}
\index{rtems\_extension\_delete@{rtems\_extension\_delete}!User Extensions@{User Extensions}}
\subsubsection{\texorpdfstring{rtems\_extension\_delete()}{rtems\_extension\_delete()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+extension\+\_\+delete (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__ClassicTasks_gab20892b814dced7dd4e5b9bf42becd57}{rtems\+\_\+id}}}]{id }\end{DoxyParamCaption})}



Deletes an extension set object specified by the identifier {\itshape id}. 

Any subsequent references to the extension\textquotesingle{}s name and identifier are invalid.

This directive will not cause the calling task to be preempted.


\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Extension set deleted successfully. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+ID} & Invalid extension set identifier. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{group__ClassicUserExtensions_ga0286a5c091767c95c1eb1c80abca42d6}\label{group__ClassicUserExtensions_ga0286a5c091767c95c1eb1c80abca42d6}} 
\index{User Extensions@{User Extensions}!rtems\_extension\_ident@{rtems\_extension\_ident}}
\index{rtems\_extension\_ident@{rtems\_extension\_ident}!User Extensions@{User Extensions}}
\subsubsection{\texorpdfstring{rtems\_extension\_ident()}{rtems\_extension\_ident()}}
{\footnotesize\ttfamily \mbox{\hyperlink{group__ClassicStatus_ga545d41846817eaba6143d52ee4d9e9fe}{rtems\+\_\+status\+\_\+code}} rtems\+\_\+extension\+\_\+ident (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{group__ClassicTasks_ga55fb63c49f68c0cbd9bee004da15b1fd}{rtems\+\_\+name}}}]{name,  }\item[{\mbox{\hyperlink{group__ClassicTasks_gab20892b814dced7dd4e5b9bf42becd57}{rtems\+\_\+id}} $\ast$}]{id }\end{DoxyParamCaption})}



Identifies an extension set object by a name. 

This directive obtains an extension set identifier in {\itshape id} associated with the extension set name {\itshape name}. If the extension set name is not unique, then the extension set identifier will match one of the extension sets with that name. However, this extension set identifier is not guaranteed to correspond to the desired extension set. The extension set identifier is used to access this extension set in other extension set related directives.

This directive will not cause the calling task to be preempted.


\begin{DoxyRetVals}{Return values}
{\em R\+T\+E\+M\+S\+\_\+\+S\+U\+C\+C\+E\+S\+S\+F\+UL} & Extension set identified successfully. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+D\+D\+R\+E\+SS} & Identifier pointer is {\ttfamily N\+U\+LL}. \\
\hline
{\em R\+T\+E\+M\+S\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+N\+A\+ME} & Extension set name not found or invalid name. \\
\hline
\end{DoxyRetVals}
