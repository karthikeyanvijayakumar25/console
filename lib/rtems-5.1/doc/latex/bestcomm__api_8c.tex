\hypertarget{bestcomm__api_8c}{}\section{bsps/powerpc/gen5200/bestcomm/bestcomm\+\_\+api.c File Reference}
\label{bestcomm__api_8c}\index{bsps/powerpc/gen5200/bestcomm/bestcomm\_api.c@{bsps/powerpc/gen5200/bestcomm/bestcomm\_api.c}}
{\ttfamily \#include $<$bsp/bestcomm/include/ppctypes.\+h$>$}\newline
{\ttfamily \#include $<$bsp/bestcomm/bestcomm\+\_\+api.\+h$>$}\newline
{\ttfamily \#include $<$bsp/bestcomm/task\+\_\+api/bestcomm\+\_\+cntrl.\+h$>$}\newline
{\ttfamily \#include $<$bsp/bestcomm/task\+\_\+api/bestcomm\+\_\+api\+\_\+mem.\+h$>$}\newline
{\ttfamily \#include $<$bsp/bestcomm/task\+\_\+api/tasksetup\+\_\+bdtable.\+h$>$}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
const char $\ast$ \mbox{\hyperlink{bestcomm__api_8c_a1fe2b4c534707dc2ffa76134dbdd18a6}{Task\+Version}} (void)
\begin{DoxyCompactList}\small\item\em Get a string containing A\+PI version information. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{bestcomm__api_8c_ae914efa36122a772ac8ad8848ec0812a}{Tasks\+Init\+A\+PI}} (uint8 $\ast$M\+Bar\+Ref)
\begin{DoxyCompactList}\small\item\em Initialize the A\+PI. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{bestcomm__api_8c_a218e71b4e0b0e6e1fdbda806bdf937f7}{Tasks\+Init\+A\+P\+I\+\_\+\+VM}} (uint8 $\ast$M\+Bar\+Ref, uint8 $\ast$M\+Bar\+Phys)
\begin{DoxyCompactList}\small\item\em Initialize the A\+PI when virtual memory is used. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{bestcomm__api_8c_af0debe7b5957175c27dd80de6359d264}{Tasks\+Attach\+Image}} (\mbox{\hyperlink{structsdma__register__set}{sdma\+\_\+regs}} $\ast$sdma)
\begin{DoxyCompactList}\small\item\em {\itshape Deprecated} \end{DoxyCompactList}\item 
int \mbox{\hyperlink{bestcomm__api_8c_a2b48145c6c0418944c8226075ba97e7a}{Task\+Start}} (Task\+Id task\+Id, uint32 auto\+Start\+Enable, Task\+Id auto\+Start\+Task, uint32 intr\+Enable)
\begin{DoxyCompactList}\small\item\em Start an initialized task running. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{bestcomm__api_8c_a50a0e8468075caefc2c8594375e095fd}{Task\+Stop}} (Task\+Id task\+Id)
\begin{DoxyCompactList}\small\item\em Stop a running task. \end{DoxyCompactList}\item 
B\+D\+Idx \mbox{\hyperlink{bestcomm__api_8c_a4117e7e78d83c86e3430384f56004629}{Task\+B\+D\+Assign}} (Task\+Id task\+Id, void $\ast$buffer0, void $\ast$buffer1, int \mbox{\hyperlink{sun4u_2tte_8h_a245260f6f74972558f61b85227df5aae}{size}}, uint32 bd\+Flags)
\begin{DoxyCompactList}\small\item\em Assign a buffer to a buffer descriptor. \end{DoxyCompactList}\item 
B\+D\+Idx \mbox{\hyperlink{bestcomm__api_8c_adaf12022da391fada14f3a5621da86a3}{Task\+B\+D\+Release}} (Task\+Id task\+Id)
\begin{DoxyCompactList}\small\item\em Release last buffer in the buffer descriptor ring. \end{DoxyCompactList}\item 
B\+D\+Idx \mbox{\hyperlink{bestcomm__api_8c_a3d74620a816775576cfa503865033827}{Task\+B\+D\+Reset}} (Task\+Id task\+Id)
\begin{DoxyCompactList}\small\item\em Release all buffers. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{bestcomm__api_8c_a455957c637fde5586390764bbc17cbfd}{Task\+Debug}} (Task\+Id task\+Id, \mbox{\hyperlink{structTaskDebugParamSet__t}{Task\+Debug\+Param\+Set\+\_\+t}} $\ast$param\+Set)
\begin{DoxyCompactList}\small\item\em Return Best\+Comm debug information. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{bestcomm__api_8c_ac43dd461deeff3a0a220583107b4543e}\label{bestcomm__api_8c_ac43dd461deeff3a0a220583107b4543e}} 
uint8 $\ast$ {\bfseries M\+Bar\+Global}
\item 
\mbox{\Hypertarget{bestcomm__api_8c_aaa5261fb9f502faa9fdcae1184aadd8b}\label{bestcomm__api_8c_aaa5261fb9f502faa9fdcae1184aadd8b}} 
sint64 {\bfseries M\+Bar\+Phys\+Offset\+Global}
\item 
\mbox{\Hypertarget{bestcomm__api_8c_ac357e2a3f3527a071157fdab790443ff}\label{bestcomm__api_8c_ac357e2a3f3527a071157fdab790443ff}} 
int {\bfseries Task\+Running} \mbox{[}\mbox{\hyperlink{bestcomm__api_8h_aac747bed84189f8cfa509b94d488e622}{M\+A\+X\+\_\+\+T\+A\+S\+KS}}\mbox{]}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Bestcomm\+\_\+api.\+c implements most of the Best\+Comm C A\+PI. The Task\+Setup() function is generated by the Best\+Comm Task A\+PI tools in capi/task\+\_\+api/tasksetup\+\_\+general.\+h as configured and included by code\+\_\+dma/image\+\_\+rtos?/task\+\_\+capi/($\ast$).c. Other functions are defined as inline in capi/bestcomm\+\_\+api.\+h. 

\subsection{Function Documentation}
\mbox{\Hypertarget{bestcomm__api_8c_a4117e7e78d83c86e3430384f56004629}\label{bestcomm__api_8c_a4117e7e78d83c86e3430384f56004629}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskBDAssign@{TaskBDAssign}}
\index{TaskBDAssign@{TaskBDAssign}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskBDAssign()}{TaskBDAssign()}}
{\footnotesize\ttfamily B\+D\+Idx Task\+B\+D\+Assign (\begin{DoxyParamCaption}\item[{Task\+Id}]{task\+Id,  }\item[{void $\ast$}]{buffer0,  }\item[{void $\ast$}]{buffer1,  }\item[{int}]{size,  }\item[{uint32}]{bd\+Flags }\end{DoxyParamCaption})}



Assign a buffer to a buffer descriptor. 


\begin{DoxyParams}{Parameters}
{\em task\+Id} & Task handle passed back from a successful Task\+Setup() \\
\hline
{\em buffer0} & A buffer to send data from or receive data into a device \\
\hline
{\em buffer1} & A second buffer to send data from or receive data into a device for use with double-\/buffer tasks. \\
\hline
{\em size} & Size of the buffer in bytes. \\
\hline
{\em bd\+Flags} & Buffer descriptor flags to set. Used by ethernet BD tasks. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Handle to the buffer descriptor used by this D\+MA transfer. Error is indicated by a negative return value (see Task\+Err\+\_\+t).
\end{DoxyReturn}
This function is used for both transmit and receive buffer descriptor tasks. The buffer may be freed by the \mbox{\hyperlink{bestcomm__api_8c_adaf12022da391fada14f3a5621da86a3}{Task\+B\+D\+Release()}} function. In the case of tasks with a buffer descriptor with two buffer pointers this function uses both buffer0 and buffer1 where buffer0 is a source and buffer1 is a destination. When the buffer descriptor is a single pointer type, the buffer0 is the only pointer used and buffer1 is ignored.

Using this function on non-\/buffer descriptor tasks will produce unpredictable results. \mbox{\Hypertarget{bestcomm__api_8c_adaf12022da391fada14f3a5621da86a3}\label{bestcomm__api_8c_adaf12022da391fada14f3a5621da86a3}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskBDRelease@{TaskBDRelease}}
\index{TaskBDRelease@{TaskBDRelease}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskBDRelease()}{TaskBDRelease()}}
{\footnotesize\ttfamily B\+D\+Idx Task\+B\+D\+Release (\begin{DoxyParamCaption}\item[{Task\+Id}]{task\+Id }\end{DoxyParamCaption})}



Release last buffer in the buffer descriptor ring. 


\begin{DoxyParams}{Parameters}
{\em task\+Id} & Task handle passed back from a successful Task\+Setup()\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Buffer descriptor index of next buffer index that will be released by another call of this function. T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+B\+D\+\_\+\+R\+I\+N\+G\+\_\+\+E\+M\+P\+TY is returned if the ring is already empty.
\end{DoxyReturn}
This function allows the system to reallocate the memory used by the buffer. It also cleans up the structure in the BD ring by removing the tail buffer in the ring. The buffer descriptor tasks are designed around this. Non-\/\+BD tasks do not use this function.

Using this function on non-\/buffer descriptor tasks will produce unpredictable results. \mbox{\Hypertarget{bestcomm__api_8c_a3d74620a816775576cfa503865033827}\label{bestcomm__api_8c_a3d74620a816775576cfa503865033827}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskBDReset@{TaskBDReset}}
\index{TaskBDReset@{TaskBDReset}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskBDReset()}{TaskBDReset()}}
{\footnotesize\ttfamily B\+D\+Idx Task\+B\+D\+Reset (\begin{DoxyParamCaption}\item[{Task\+Id}]{task\+Id }\end{DoxyParamCaption})}



Release all buffers. 


\begin{DoxyParams}{Parameters}
{\em task\+Id} & Task handle passed back from a successful Task\+Setup()\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Buffer descriptor index of next buffer that will be assigned by \mbox{\hyperlink{bestcomm__api_8c_a4117e7e78d83c86e3430384f56004629}{Task\+B\+D\+Assign()}} which will also be the first released by the next call to \mbox{\hyperlink{bestcomm__api_8c_adaf12022da391fada14f3a5621da86a3}{Task\+B\+D\+Release()}} or T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+T\+A\+S\+K\+\_\+\+R\+U\+N\+N\+I\+NG if the task has not been stopped.
\end{DoxyReturn}
This function is similar to \mbox{\hyperlink{bestcomm__api_8c_adaf12022da391fada14f3a5621da86a3}{Task\+B\+D\+Release()}} except that it releases all assigned buffers including those not yet processed by the Best\+Comm task; i.\+e. S\+D\+M\+A\+\_\+\+B\+D\+\_\+\+M\+A\+S\+K\+\_\+\+R\+E\+A\+DY is set. Non-\/\+BD tasks do not use this function.

The task should not be running. Call \mbox{\hyperlink{bestcomm__api_8c_a50a0e8468075caefc2c8594375e095fd}{Task\+Stop()}} first.

{\itshape Note\+:} Partially transmitted buffers are up to the user to handle.

Using this function on non-\/buffer descriptor tasks will produce unpredictable results. \mbox{\Hypertarget{bestcomm__api_8c_a455957c637fde5586390764bbc17cbfd}\label{bestcomm__api_8c_a455957c637fde5586390764bbc17cbfd}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskDebug@{TaskDebug}}
\index{TaskDebug@{TaskDebug}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskDebug()}{TaskDebug()}}
{\footnotesize\ttfamily int Task\+Debug (\begin{DoxyParamCaption}\item[{Task\+Id}]{task\+Id,  }\item[{\mbox{\hyperlink{structTaskDebugParamSet__t}{Task\+Debug\+Param\+Set\+\_\+t}} $\ast$}]{param\+Set }\end{DoxyParamCaption})}



Return Best\+Comm debug information. 


\begin{DoxyParams}{Parameters}
{\em task\+Id} & Task handle passed back from a successful Task\+Setup() \\
\hline
{\em param\+Set} & T\+BD \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+BD
\end{DoxyReturn}
The implementation of this function is yet to be determined. \mbox{\Hypertarget{bestcomm__api_8c_af0debe7b5957175c27dd80de6359d264}\label{bestcomm__api_8c_af0debe7b5957175c27dd80de6359d264}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TasksAttachImage@{TasksAttachImage}}
\index{TasksAttachImage@{TasksAttachImage}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TasksAttachImage()}{TasksAttachImage()}}
{\footnotesize\ttfamily int Tasks\+Attach\+Image (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structsdma__register__set}{sdma\+\_\+regs}} $\ast$}]{sdma }\end{DoxyParamCaption})}



{\itshape Deprecated} 


\begin{DoxyParams}{Parameters}
{\em sdma} & Base address of the Best\+Comm register set\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+N\+O\+\_\+\+E\+RR
\end{DoxyReturn}
Use of this function is no longer necessary. It is retained for compatibility with previous versions of the A\+PI. \mbox{\Hypertarget{bestcomm__api_8c_ae914efa36122a772ac8ad8848ec0812a}\label{bestcomm__api_8c_ae914efa36122a772ac8ad8848ec0812a}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TasksInitAPI@{TasksInitAPI}}
\index{TasksInitAPI@{TasksInitAPI}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TasksInitAPI()}{TasksInitAPI()}}
{\footnotesize\ttfamily int Tasks\+Init\+A\+PI (\begin{DoxyParamCaption}\item[{uint8 $\ast$}]{M\+Bar\+Ref }\end{DoxyParamCaption})}



Initialize the A\+PI. 


\begin{DoxyParams}{Parameters}
{\em M\+Bar\+Ref} & Reference pointer to the device register memory map.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+N\+O\+\_\+\+E\+RR on successful initialization. or T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+A\+P\+I\+\_\+\+A\+L\+R\+E\+A\+D\+Y\+\_\+\+I\+N\+I\+T\+I\+A\+L\+I\+Z\+ED.
\end{DoxyReturn}
This function is only used with physical addresses.

This function will also initialize A\+PI internal variables. The return value T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+A\+P\+I\+\_\+\+A\+L\+R\+E\+A\+D\+Y\+\_\+\+I\+N\+I\+T\+I\+A\+L\+I\+Z\+ED is intended to help determine if another process has already instantiated a version of the A\+PI. \mbox{\Hypertarget{bestcomm__api_8c_a218e71b4e0b0e6e1fdbda806bdf937f7}\label{bestcomm__api_8c_a218e71b4e0b0e6e1fdbda806bdf937f7}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TasksInitAPI\_VM@{TasksInitAPI\_VM}}
\index{TasksInitAPI\_VM@{TasksInitAPI\_VM}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TasksInitAPI\_VM()}{TasksInitAPI\_VM()}}
{\footnotesize\ttfamily int Tasks\+Init\+A\+P\+I\+\_\+\+VM (\begin{DoxyParamCaption}\item[{uint8 $\ast$}]{M\+Bar\+Ref,  }\item[{uint8 $\ast$}]{M\+Bar\+Phys }\end{DoxyParamCaption})}



Initialize the A\+PI when virtual memory is used. 


\begin{DoxyParams}{Parameters}
{\em M\+Bar\+Ref} & Reference pointer to the device register memory map. \\
\hline
{\em M\+Bar\+Phys} & Actual physical location of M\+B\+AR device register memory map.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+N\+O\+\_\+\+E\+RR on successful initialization. or T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+A\+P\+I\+\_\+\+A\+L\+R\+E\+A\+D\+Y\+\_\+\+I\+N\+I\+T\+I\+A\+L\+I\+Z\+ED.
\end{DoxyReturn}
This function allows using virtual memory addresses as well as physical addresses. All device registers are offset to the address supplied here, so the virtual memory space should include enough space for the entire register set of the device to include the S\+R\+AM space.

This function will also initialize A\+PI internal variables. The return value T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+A\+P\+I\+\_\+\+A\+L\+R\+E\+A\+D\+Y\+\_\+\+I\+N\+I\+T\+I\+A\+L\+I\+Z\+ED is intended to help determine if another process has already instantiated a version of the A\+PI. \mbox{\Hypertarget{bestcomm__api_8c_a2b48145c6c0418944c8226075ba97e7a}\label{bestcomm__api_8c_a2b48145c6c0418944c8226075ba97e7a}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskStart@{TaskStart}}
\index{TaskStart@{TaskStart}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskStart()}{TaskStart()}}
{\footnotesize\ttfamily int Task\+Start (\begin{DoxyParamCaption}\item[{Task\+Id}]{task\+Id,  }\item[{uint32}]{auto\+Start\+Enable,  }\item[{Task\+Id}]{auto\+Start\+Task,  }\item[{uint32}]{intr\+Enable }\end{DoxyParamCaption})}



Start an initialized task running. 


\begin{DoxyParams}{Parameters}
{\em task\+Id} & Task handle passed back from a successful Task\+Setup() \\
\hline
{\em auto\+Start\+Enable} & Boolean for whether autostart bit is enabled. If this is set then the parameter auto\+Start\+Task defines the task to auto start. \\
\hline
{\em auto\+Start\+Task} & Task\+Id for task to autostart. If auto\+Start\+Enable is not set then this parameter is a don\textquotesingle{}t care. \\
\hline
{\em intr\+Enable} & Boolean for interrupt enable for this task. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+N\+O\+\_\+\+E\+RR on success or T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+RG if task\+Id is invalid. 
\end{DoxyReturn}
\mbox{\Hypertarget{bestcomm__api_8c_a50a0e8468075caefc2c8594375e095fd}\label{bestcomm__api_8c_a50a0e8468075caefc2c8594375e095fd}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskStop@{TaskStop}}
\index{TaskStop@{TaskStop}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskStop()}{TaskStop()}}
{\footnotesize\ttfamily int Task\+Stop (\begin{DoxyParamCaption}\item[{Task\+Id}]{task\+Id }\end{DoxyParamCaption})}



Stop a running task. 


\begin{DoxyParams}{Parameters}
{\em task\+Id} & Task handle passed back from a successful Task\+Setup() \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+N\+O\+\_\+\+E\+RR on success or T\+A\+S\+K\+\_\+\+E\+R\+R\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+A\+RG if task\+Id is invalid.
\end{DoxyReturn}
{\itshape Note\+:} Stopping a polling buffer descriptor task is a catastrophic operation. It does not merely pause execution. Context is not saved. The task\textquotesingle{}s pointer into the BD ring is reset back to the beginning.

{\itshape Note\+:} This is not the case for the new \char`\"{}fall-\/through\char`\"{} BD tasks. They save the BD ring pointer across stop/start boundaries. The previous polling tasks are considered deprecated. \mbox{\Hypertarget{bestcomm__api_8c_a1fe2b4c534707dc2ffa76134dbdd18a6}\label{bestcomm__api_8c_a1fe2b4c534707dc2ffa76134dbdd18a6}} 
\index{bestcomm\_api.c@{bestcomm\_api.c}!TaskVersion@{TaskVersion}}
\index{TaskVersion@{TaskVersion}!bestcomm\_api.c@{bestcomm\_api.c}}
\subsubsection{\texorpdfstring{TaskVersion()}{TaskVersion()}}
{\footnotesize\ttfamily const char$\ast$ Task\+Version (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Get a string containing A\+PI version information. 

\begin{DoxyReturn}{Returns}
Pointer to the A\+PI version string 
\end{DoxyReturn}
