\hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c}{}\section{bsps/mips/rbtx4938/clock/clockdrv.c File Reference}
\label{mips_2rbtx4938_2clock_2clockdrv_8c}\index{bsps/mips/rbtx4938/clock/clockdrv.c@{bsps/mips/rbtx4938/clock/clockdrv.c}}
{\ttfamily \#include $<$rtems.\+h$>$}\newline
{\ttfamily \#include $<$bsp/irq.\+h$>$}\newline
{\ttfamily \#include $<$bsp.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}yamon\+\_\+api.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}../../../shared/dev/clock/clockimpl.\+h\char`\"{}}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a4edae1f7872fdace9eb64c197b3f952d}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a4edae1f7872fdace9eb64c197b3f952d}} 
\#define {\bfseries C\+L\+O\+C\+K\+\_\+\+V\+E\+C\+T\+OR}~T\+X4938\+\_\+\+I\+R\+Q\+\_\+\+T\+M\+R0
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a813ef57a15b287374c061015bae99cf2}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a813ef57a15b287374c061015bae99cf2}} 
\#define {\bfseries T\+X4938\+\_\+\+T\+I\+M\+E\+R\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+M\+O\+DE}~1
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a7872d2a7791c2f1393725680dbd764c1}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a7872d2a7791c2f1393725680dbd764c1}} 
\#define {\bfseries T\+X4938\+\_\+\+T\+I\+M\+E\+R\+\_\+\+M\+O\+DE}~T\+X4938\+\_\+\+T\+I\+M\+E\+R\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+M\+O\+DE
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a3433c673bc9b2994e7462589588f8447}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a3433c673bc9b2994e7462589588f8447}} 
\#define {\bfseries T\+X4938\+\_\+\+T\+I\+M\+E\+R\+\_\+\+I\+N\+T\+E\+R\+R\+U\+P\+T\+\_\+\+F\+L\+AG}~T\+I\+IS
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a37475981ff0420ed43474fb3bdde8cbf}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a37475981ff0420ed43474fb3bdde8cbf}} 
\#define {\bfseries Clock\+\_\+driver\+\_\+support\+\_\+initialize\+\_\+hardware}()~Initialize\+\_\+timer0\+\_\+in\+\_\+interval\+\_\+mode()
\item 
\#define {\bfseries Clock\+\_\+driver\+\_\+support\+\_\+install\+\_\+isr}(\+\_\+new)
\item 
\#define {\bfseries Clock\+\_\+driver\+\_\+support\+\_\+at\+\_\+tick}()
\item 
\#define {\bfseries Initialize\+\_\+timer0\+\_\+in\+\_\+interval\+\_\+mode}()
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_ab733c59b870d1dbad7a80319644fb5d4}\label{mips_2rbtx4938_2clock_2clockdrv_8c_ab733c59b870d1dbad7a80319644fb5d4}} 
\#define {\bfseries C\+L\+O\+C\+K\+\_\+\+D\+R\+I\+V\+E\+R\+\_\+\+U\+S\+E\+\_\+\+D\+U\+M\+M\+Y\+\_\+\+T\+I\+M\+E\+C\+O\+U\+N\+T\+ER}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a9c201d069f2fac807fe88dac382e5ed2}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a9c201d069f2fac807fe88dac382e5ed2}} 
void {\bfseries new\+\_\+brk\+\_\+esr} (void)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a532f9c2c8dd17aed498975f259f80f46}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a532f9c2c8dd17aed498975f259f80f46}} 
t\+\_\+yamon\+\_\+retfunc {\bfseries esr\+\_\+retfunc} = 0
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a0e7b498c754062cf8b910d0ccdfd8f4f}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a0e7b498c754062cf8b910d0ccdfd8f4f}} 
t\+\_\+yamon\+\_\+ref {\bfseries original\+\_\+brk\+\_\+esr} = 0
\item 
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_ab40addb01426b0a410cf96fac223e50b}\label{mips_2rbtx4938_2clock_2clockdrv_8c_ab40addb01426b0a410cf96fac223e50b}} 
t\+\_\+yamon\+\_\+ref {\bfseries original\+\_\+tmr0\+\_\+isr} = 0
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Instantiate the clock driver shell. 

\subsection{Macro Definition Documentation}
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_ad0860321c2b7838ffea30059aebd26fa}\label{mips_2rbtx4938_2clock_2clockdrv_8c_ad0860321c2b7838ffea30059aebd26fa}} 
\index{clockdrv.c@{clockdrv.c}!Clock\_driver\_support\_at\_tick@{Clock\_driver\_support\_at\_tick}}
\index{Clock\_driver\_support\_at\_tick@{Clock\_driver\_support\_at\_tick}!clockdrv.c@{clockdrv.c}}
\subsubsection{\texorpdfstring{Clock\_driver\_support\_at\_tick}{Clock\_driver\_support\_at\_tick}}
{\footnotesize\ttfamily \#define Clock\+\_\+driver\+\_\+support\+\_\+at\+\_\+tick(\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordflow}{do} \{ \(\backslash\)}
\DoxyCodeLine{    uint32\_t interrupt\_flag; \(\backslash\)}
\DoxyCodeLine{    do \{ \(\backslash\)}
\DoxyCodeLine{        int loop\_count; \(\backslash\)}
\DoxyCodeLine{        TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_TISR, 0x0 ); \textcolor{comment}{/* Clear timer 0 interrupt */} \(\backslash\)}
\DoxyCodeLine{            loop\_count = 0; \(\backslash\)}
\DoxyCodeLine{            do \{ \textcolor{comment}{/* Wait until interrupt flag is cleared (this prevents re-entering interrupt) */} \(\backslash\)}
\DoxyCodeLine{                \textcolor{comment}{/* Read back interrupt status register and isolate interval timer flag */} \(\backslash\)}
\DoxyCodeLine{                interrupt\_flag = TX4938\_REG\_READ( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_TISR ) \& TX4938\_TIMER\_INTERRUPT\_FLAG; \(\backslash\)}
\DoxyCodeLine{            \} \textcolor{keywordflow}{while} (interrupt\_flag \&\& (++loop\_count < 10)); \textcolor{comment}{/* Loop while timer interrupt bit is set, or loop count is lees than 10 */} \(\backslash\)}
\DoxyCodeLine{    \} \textcolor{keywordflow}{while}(interrupt\_flag); \(\backslash\)}
\DoxyCodeLine{  \} \textcolor{keywordflow}{while}(0)}

\end{DoxyCode}
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_a98b2c75f88d730742ba1e0b5b4950a4d}\label{mips_2rbtx4938_2clock_2clockdrv_8c_a98b2c75f88d730742ba1e0b5b4950a4d}} 
\index{clockdrv.c@{clockdrv.c}!Clock\_driver\_support\_install\_isr@{Clock\_driver\_support\_install\_isr}}
\index{Clock\_driver\_support\_install\_isr@{Clock\_driver\_support\_install\_isr}!clockdrv.c@{clockdrv.c}}
\subsubsection{\texorpdfstring{Clock\_driver\_support\_install\_isr}{Clock\_driver\_support\_install\_isr}}
{\footnotesize\ttfamily \#define Clock\+\_\+driver\+\_\+support\+\_\+install\+\_\+isr(\begin{DoxyParamCaption}\item[{}]{\+\_\+new }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordflow}{do} \{ \(\backslash\)}
\DoxyCodeLine{    rtems\_interrupt\_handler\_install( \(\backslash\)}
\DoxyCodeLine{      CLOCK\_VECTOR, \(\backslash\)}
\DoxyCodeLine{      \textcolor{stringliteral}{"clock"}, \(\backslash\)}
\DoxyCodeLine{      0, \(\backslash\)}
\DoxyCodeLine{      \_new, \(\backslash\)}
\DoxyCodeLine{      \mbox{\hyperlink{bestcomm__api_8h_a872bb74de61c3689ccd5b41873fce42c}{NULL}} \(\backslash\)}
\DoxyCodeLine{    ); \(\backslash\)}
\DoxyCodeLine{    YAMON\_FUNC\_REGISTER\_IC\_ISR(17,(t\_yamon\_isr)\_new,0,\&original\_tmr0\_isr); \textcolor{comment}{/* Call Yamon to enable interrupt */} \(\backslash\)}
\DoxyCodeLine{  \} \textcolor{keywordflow}{while}(0)}

\end{DoxyCode}
\mbox{\Hypertarget{mips_2rbtx4938_2clock_2clockdrv_8c_ae1f04d491a60491db55fe27955349add}\label{mips_2rbtx4938_2clock_2clockdrv_8c_ae1f04d491a60491db55fe27955349add}} 
\index{clockdrv.c@{clockdrv.c}!Initialize\_timer0\_in\_interval\_mode@{Initialize\_timer0\_in\_interval\_mode}}
\index{Initialize\_timer0\_in\_interval\_mode@{Initialize\_timer0\_in\_interval\_mode}!clockdrv.c@{clockdrv.c}}
\subsubsection{\texorpdfstring{Initialize\_timer0\_in\_interval\_mode}{Initialize\_timer0\_in\_interval\_mode}}
{\footnotesize\ttfamily \#define Initialize\+\_\+timer0\+\_\+in\+\_\+interval\+\_\+mode(\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordflow}{do} \{ \(\backslash\)}
\DoxyCodeLine{    uint32\_t temp; \(\backslash\)}
\DoxyCodeLine{    TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_TCR, 0x0 ); \textcolor{comment}{/* Disable timer */} \(\backslash\)}
\DoxyCodeLine{    TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_CCDR, 0x0 ); \textcolor{comment}{/* Set register for divide by 2 clock */} \(\backslash\)}
\DoxyCodeLine{    TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_ITMR, TIMER\_CLEAR\_ENABLE\_MASK ); \textcolor{comment}{/* Set interval timer mode register */} \(\backslash\)}
\DoxyCodeLine{    TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_CPRA, 0x3d090 ); \textcolor{comment}{/* Set tmier period ,10.0 msec (25 MHz timer clock) */} \(\backslash\)}
\DoxyCodeLine{    TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_TCR, 0xC0 ); \textcolor{comment}{/* Enable timer in interval mode */} \(\backslash\)}
\DoxyCodeLine{    temp = TX4938\_REG\_READ( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_ITMR ); \textcolor{comment}{/* Enable interval timer interrupts */} \(\backslash\)}
\DoxyCodeLine{    temp |= TIMER\_INT\_ENABLE\_MASK; \(\backslash\)}
\DoxyCodeLine{    TX4938\_REG\_WRITE( TX4938\_REG\_BASE, TX4938\_TIMER0\_BASE + TX4938\_TIMER\_ITMR, temp ); \(\backslash\)}
\DoxyCodeLine{  \} \textcolor{keywordflow}{while}(0)}

\end{DoxyCode}
