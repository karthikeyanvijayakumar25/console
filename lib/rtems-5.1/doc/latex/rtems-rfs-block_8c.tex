\hypertarget{rtems-rfs-block_8c}{}\section{cpukit/libfs/src/rfs/rtems-\/rfs-\/block.c File Reference}
\label{rtems-rfs-block_8c}\index{cpukit/libfs/src/rfs/rtems-\/rfs-\/block.c@{cpukit/libfs/src/rfs/rtems-\/rfs-\/block.c}}


R\+T\+E\+MS File Systems Block Routines.  


{\ttfamily \#include $<$inttypes.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$rtems/rfs/rtems-\/rfs-\/block.\+h$>$}\newline
{\ttfamily \#include $<$rtems/rfs/rtems-\/rfs-\/data.\+h$>$}\newline
{\ttfamily \#include $<$rtems/rfs/rtems-\/rfs-\/group.\+h$>$}\newline
{\ttfamily \#include $<$rtems/rfs/rtems-\/rfs-\/inode.\+h$>$}\newline
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{rtems-rfs-block_8c_a35848429d41d99f4aab4be97b41a324e}{rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+bpos}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}} pos, \mbox{\hyperlink{rtems-rfs-block-pos_8h_a0d8bd7482333e584a03df45e60cda226}{rtems\+\_\+rfs\+\_\+block\+\_\+pos}} $\ast$bpos)
\item 
\mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}} \mbox{\hyperlink{rtems-rfs-block_8c_a76f70461e9f76aa1f6739a13a8f26735}{rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+pos}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block-pos_8h_a0d8bd7482333e584a03df45e60cda226}{rtems\+\_\+rfs\+\_\+block\+\_\+pos}} $\ast$bpos)
\item 
void \mbox{\hyperlink{rtems-rfs-block_8c_a6982a30feb7426e107b0c899b80fbbe6}{rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+block\+\_\+size}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}} pos, \mbox{\hyperlink{rtems-rfs-block-pos_8h_aa72438eee22908110dc633ca6b89b390}{rtems\+\_\+rfs\+\_\+block\+\_\+size}} $\ast$\mbox{\hyperlink{sun4u_2tte_8h_a245260f6f74972558f61b85227df5aae}{size}})
\item 
\mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}} \mbox{\hyperlink{rtems-rfs-block_8c_a4420107003db9b6d34945a95ab14b520}{rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+size}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block-pos_8h_aa72438eee22908110dc633ca6b89b390}{rtems\+\_\+rfs\+\_\+block\+\_\+size}} $\ast$\mbox{\hyperlink{sun4u_2tte_8h_a245260f6f74972558f61b85227df5aae}{size}})
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_a5a09f0d3d9d4e31367c51ceadb7dea31}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+open}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-inode_8h_a91f02dac5a2d91e072d676f3266ab8d2}{rtems\+\_\+rfs\+\_\+inode\+\_\+handle}} $\ast$inode, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}})
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_a9f3eaf881c5744fcfe5798cea33999a7}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+close}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}})
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_a425d37b16d533475f1c60069eedfa6aa}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+find}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}}, \mbox{\hyperlink{rtems-rfs-block-pos_8h_a0d8bd7482333e584a03df45e60cda226}{rtems\+\_\+rfs\+\_\+block\+\_\+pos}} $\ast$bpos, \mbox{\hyperlink{rtems-rfs-block-pos_8h_abbf8bb95acf9bd16ed3291f7da518e9a}{rtems\+\_\+rfs\+\_\+block\+\_\+no}} $\ast$block)
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_a0bb73241f191cf0f14dee8c309e8d577}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+seek}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}}, \mbox{\hyperlink{rtems-rfs-file-system_8h_af6bccb465dcd34c68e9f0c214950ef57}{rtems\+\_\+rfs\+\_\+pos\+\_\+rel}} offset, \mbox{\hyperlink{rtems-rfs-block-pos_8h_abbf8bb95acf9bd16ed3291f7da518e9a}{rtems\+\_\+rfs\+\_\+block\+\_\+no}} $\ast$block)
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_af76c5594aa8b24cb57000a1a9de72c2d}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+next\+\_\+block}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}}, \mbox{\hyperlink{rtems-rfs-block-pos_8h_abbf8bb95acf9bd16ed3291f7da518e9a}{rtems\+\_\+rfs\+\_\+block\+\_\+no}} $\ast$block)
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_aa0041e23dc7269c746a5d198fda8426d}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+grow}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}}, size\+\_\+t blocks, \mbox{\hyperlink{rtems-rfs-block-pos_8h_abbf8bb95acf9bd16ed3291f7da518e9a}{rtems\+\_\+rfs\+\_\+block\+\_\+no}} $\ast$new\+\_\+block)
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_a1609f6d6ac4378a5df7935a69bb2884d}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+shrink}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}}, size\+\_\+t blocks)
\item 
int \mbox{\hyperlink{rtems-rfs-block_8c_a1918b1aa888c6545497402764528ef99}{rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+free\+\_\+all}} (\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$fs, \mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$\mbox{\hyperlink{struct__map}{map}})
\end{DoxyCompactItemize}


\subsection{Detailed Description}
R\+T\+E\+MS File Systems Block Routines. 

These functions manage blocks in the R\+FS file system. A block is an area of the media and its size is set for a each specific media. The block size is set when the file system is set up and needs to be matched for it to be read correctly.

Blocks are managed as groups. A block group or \char`\"{}group\char`\"{} is part of the total number of blocks being managed by the file system and exist to allow resources to localised. A file in a directory will be allocated blocks in the same group as the directory, and the blocks for the file will also be allocated in the same group.

A group consist of a block bitmap, inodes and data blocks. The first block of the file system will hold the superblock. The block bitmap is a collection of blocks that hold a map of bits, one bit per block for each block in the group. When a file system is mounted the block bitmaps are read and a summary bit map is made. The summary bitmap has a single bit for 32 bits in the bitmap and is set when all 32 bits it maps to are set. This speeds up the search for a free block by a factor of 32. 

\subsection{Function Documentation}
\mbox{\Hypertarget{rtems-rfs-block_8c_a6982a30feb7426e107b0c899b80fbbe6}\label{rtems-rfs-block_8c_a6982a30feb7426e107b0c899b80fbbe6}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_get\_block\_size@{rtems\_rfs\_block\_get\_block\_size}}
\index{rtems\_rfs\_block\_get\_block\_size@{rtems\_rfs\_block\_get\_block\_size}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_get\_block\_size()}{rtems\_rfs\_block\_get\_block\_size()}}
{\footnotesize\ttfamily void rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+block\+\_\+size (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}}}]{pos,  }\item[{\mbox{\hyperlink{rtems-rfs-block-pos_8h_aa72438eee22908110dc633ca6b89b390}{rtems\+\_\+rfs\+\_\+block\+\_\+size}} $\ast$}]{size }\end{DoxyParamCaption})}

Set the size given a position.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em pos} & is the position as an absolute offset from the start. \\
\hline
\mbox{\texttt{ out}}  & {\em size} & is a pointer to the block size to fill in. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{rtems-rfs-block_8c_a35848429d41d99f4aab4be97b41a324e}\label{rtems-rfs-block_8c_a35848429d41d99f4aab4be97b41a324e}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_get\_bpos@{rtems\_rfs\_block\_get\_bpos}}
\index{rtems\_rfs\_block\_get\_bpos@{rtems\_rfs\_block\_get\_bpos}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_get\_bpos()}{rtems\_rfs\_block\_get\_bpos()}}
{\footnotesize\ttfamily void rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+bpos (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}}}]{pos,  }\item[{\mbox{\hyperlink{rtems-rfs-block-pos_8h_a0d8bd7482333e584a03df45e60cda226}{rtems\+\_\+rfs\+\_\+block\+\_\+pos}} $\ast$}]{bpos }\end{DoxyParamCaption})}

Given a position compute the block number and block offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em pos} & is the position as an absolute offset from the start. \\
\hline
\mbox{\texttt{ out}}  & {\em bpos} & is a pointer to the block position to fill in. \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{rtems-rfs-block_8c_a76f70461e9f76aa1f6739a13a8f26735}\label{rtems-rfs-block_8c_a76f70461e9f76aa1f6739a13a8f26735}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_get\_pos@{rtems\_rfs\_block\_get\_pos}}
\index{rtems\_rfs\_block\_get\_pos@{rtems\_rfs\_block\_get\_pos}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_get\_pos()}{rtems\_rfs\_block\_get\_pos()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}} rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+pos (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block-pos_8h_a0d8bd7482333e584a03df45e60cda226}{rtems\+\_\+rfs\+\_\+block\+\_\+pos}} $\ast$}]{bpos }\end{DoxyParamCaption})}

Given a block position compute the absolute offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ out}}  & {\em bpos} & is a pointer to the block position to fill in.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em offset} & The absolute offset. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a4420107003db9b6d34945a95ab14b520}\label{rtems-rfs-block_8c_a4420107003db9b6d34945a95ab14b520}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_get\_size@{rtems\_rfs\_block\_get\_size}}
\index{rtems\_rfs\_block\_get\_size@{rtems\_rfs\_block\_get\_size}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_get\_size()}{rtems\_rfs\_block\_get\_size()}}
{\footnotesize\ttfamily \mbox{\hyperlink{rtems-rfs-file-system_8h_ae6adc04fe673c46403605d64f16699bd}{rtems\+\_\+rfs\+\_\+pos}} rtems\+\_\+rfs\+\_\+block\+\_\+get\+\_\+size (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block-pos_8h_aa72438eee22908110dc633ca6b89b390}{rtems\+\_\+rfs\+\_\+block\+\_\+size}} $\ast$}]{size }\end{DoxyParamCaption})}

Calculate the position given the number of blocks and the offset. If the block count is 0 the size is 0. If the block is greater than 0 and the offset is 0 the size is number of blocks multipled by the block size and if the offset is not 0 it is the offset into the last block. For example if blocks is 1 and offset is 0 the size is the block size. If the block count is 1 and size is 100 the size is 100.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em size} & The size in blocks and offset.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em size} & The size in bytes. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a9f3eaf881c5744fcfe5798cea33999a7}\label{rtems-rfs-block_8c_a9f3eaf881c5744fcfe5798cea33999a7}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_close@{rtems\_rfs\_block\_map\_close}}
\index{rtems\_rfs\_block\_map\_close@{rtems\_rfs\_block\_map\_close}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_close()}{rtems\_rfs\_block\_map\_close()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+close (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map }\end{DoxyParamCaption})}

Close the map. The buffer handles are closed and any help buffers are released.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the map that is opened.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a425d37b16d533475f1c60069eedfa6aa}\label{rtems-rfs-block_8c_a425d37b16d533475f1c60069eedfa6aa}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_find@{rtems\_rfs\_block\_map\_find}}
\index{rtems\_rfs\_block\_map\_find@{rtems\_rfs\_block\_map\_find}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_find()}{rtems\_rfs\_block\_map\_find()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+find (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map,  }\item[{\mbox{\hyperlink{rtems-rfs-block-pos_8h_a0d8bd7482333e584a03df45e60cda226}{rtems\+\_\+rfs\+\_\+block\+\_\+pos}} $\ast$}]{bpos,  }\item[{\mbox{\hyperlink{rtems-rfs-buffer_8h_a5650d53328a5af0a78198fe780aec043}{rtems\+\_\+rfs\+\_\+buffer\+\_\+block}} $\ast$}]{block }\end{DoxyParamCaption})}

Find a block number in the map from the position provided.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the map to search. \\
\hline
\mbox{\texttt{ in}}  & {\em bpos} & is a pointer to the block position to find. \\
\hline
\mbox{\texttt{ out}}  & {\em block} & will contain the block in when found.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a1918b1aa888c6545497402764528ef99}\label{rtems-rfs-block_8c_a1918b1aa888c6545497402764528ef99}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_free\_all@{rtems\_rfs\_block\_map\_free\_all}}
\index{rtems\_rfs\_block\_map\_free\_all@{rtems\_rfs\_block\_map\_free\_all}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_free\_all()}{rtems\_rfs\_block\_map\_free\_all()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+free\+\_\+all (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map }\end{DoxyParamCaption})}

Free all blocks in the map.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the open map to free all blocks from.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_aa0041e23dc7269c746a5d198fda8426d}\label{rtems-rfs-block_8c_aa0041e23dc7269c746a5d198fda8426d}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_grow@{rtems\_rfs\_block\_map\_grow}}
\index{rtems\_rfs\_block\_map\_grow@{rtems\_rfs\_block\_map\_grow}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_grow()}{rtems\_rfs\_block\_map\_grow()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+grow (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map,  }\item[{size\+\_\+t}]{blocks,  }\item[{\mbox{\hyperlink{rtems-rfs-block-pos_8h_abbf8bb95acf9bd16ed3291f7da518e9a}{rtems\+\_\+rfs\+\_\+block\+\_\+no}} $\ast$}]{new\+\_\+block }\end{DoxyParamCaption})}

Grow the block map by the specified number of blocks.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the open map to grow. \\
\hline
\mbox{\texttt{ in}}  & {\em blocks} & is the number of blocks to grow the map by. \\
\hline
\mbox{\texttt{ out}}  & {\em new\+\_\+block} & will contain first of the blocks allocated to the map.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_af76c5594aa8b24cb57000a1a9de72c2d}\label{rtems-rfs-block_8c_af76c5594aa8b24cb57000a1a9de72c2d}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_next\_block@{rtems\_rfs\_block\_map\_next\_block}}
\index{rtems\_rfs\_block\_map\_next\_block@{rtems\_rfs\_block\_map\_next\_block}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_next\_block()}{rtems\_rfs\_block\_map\_next\_block()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+next\+\_\+block (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map,  }\item[{\mbox{\hyperlink{rtems-rfs-buffer_8h_a5650d53328a5af0a78198fe780aec043}{rtems\+\_\+rfs\+\_\+buffer\+\_\+block}} $\ast$}]{block }\end{DoxyParamCaption})}

Seek to the next block.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the map to search. \\
\hline
\mbox{\texttt{ out}}  & {\em block} & will contain the block in when found.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em E\+N\+X\+IO} & Failed to seek because it is outside the block map. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a5a09f0d3d9d4e31367c51ceadb7dea31}\label{rtems-rfs-block_8c_a5a09f0d3d9d4e31367c51ceadb7dea31}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_open@{rtems\_rfs\_block\_map\_open}}
\index{rtems\_rfs\_block\_map\_open@{rtems\_rfs\_block\_map\_open}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_open()}{rtems\_rfs\_block\_map\_open()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+open (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-inode_8h_a91f02dac5a2d91e072d676f3266ab8d2}{rtems\+\_\+rfs\+\_\+inode\+\_\+handle}} $\ast$}]{inode,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map }\end{DoxyParamCaption})}

Open a block map. The block map data in the inode is copied into the map. The buffer handles are opened. The block position is set to the start so a seek of offset 0 will return the first block.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em inode} & is a pointer to the inode the map belongs to. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the map that is opened.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a0bb73241f191cf0f14dee8c309e8d577}\label{rtems-rfs-block_8c_a0bb73241f191cf0f14dee8c309e8d577}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_seek@{rtems\_rfs\_block\_map\_seek}}
\index{rtems\_rfs\_block\_map\_seek@{rtems\_rfs\_block\_map\_seek}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_seek()}{rtems\_rfs\_block\_map\_seek()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+seek (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map,  }\item[{\mbox{\hyperlink{rtems-rfs-file-system_8h_af6bccb465dcd34c68e9f0c214950ef57}{rtems\+\_\+rfs\+\_\+pos\+\_\+rel}}}]{offset,  }\item[{\mbox{\hyperlink{rtems-rfs-buffer_8h_a5650d53328a5af0a78198fe780aec043}{rtems\+\_\+rfs\+\_\+buffer\+\_\+block}} $\ast$}]{block }\end{DoxyParamCaption})}

Seek around the map.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the map to search. \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & is the distance to seek. It is signed. \\
\hline
\mbox{\texttt{ out}}  & {\em block} & will contain the block in when found.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em E\+N\+X\+IO} & Failed to seek because it is outside the block map. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{rtems-rfs-block_8c_a1609f6d6ac4378a5df7935a69bb2884d}\label{rtems-rfs-block_8c_a1609f6d6ac4378a5df7935a69bb2884d}} 
\index{rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}!rtems\_rfs\_block\_map\_shrink@{rtems\_rfs\_block\_map\_shrink}}
\index{rtems\_rfs\_block\_map\_shrink@{rtems\_rfs\_block\_map\_shrink}!rtems-\/rfs-\/block.c@{rtems-\/rfs-\/block.c}}
\subsubsection{\texorpdfstring{rtems\_rfs\_block\_map\_shrink()}{rtems\_rfs\_block\_map\_shrink()}}
{\footnotesize\ttfamily int rtems\+\_\+rfs\+\_\+block\+\_\+map\+\_\+shrink (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct__rtems__rfs__file__system}{rtems\+\_\+rfs\+\_\+file\+\_\+system}} $\ast$}]{fs,  }\item[{\mbox{\hyperlink{rtems-rfs-block_8h_af488270acef452a961e888bffdc3a7bf}{rtems\+\_\+rfs\+\_\+block\+\_\+map}} $\ast$}]{map,  }\item[{size\+\_\+t}]{blocks }\end{DoxyParamCaption})}

Grow the block map by the specified number of blocks.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em fs} & is the file system data. \\
\hline
\mbox{\texttt{ in}}  & {\em map} & is a pointer to the open map to shrink. \\
\hline
\mbox{\texttt{ in}}  & {\em blocks} & is the number of blocks to shrink the map by. If more than the number of blocks the map is emptied.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & Successful operation. \\
\hline
{\em error\+\_\+code} & An error occurred. \\
\hline
\end{DoxyRetVals}
